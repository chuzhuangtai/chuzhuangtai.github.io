<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yang.Xu</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-03-06T07:21:38.185Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Yang.Xu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SpringBoot非官方教程  第十三篇：springboot集成spring cache</title>
    <link href="http://yoursite.com/2018/03/06/SpringBoot%E9%9D%9E%E5%AE%98%E6%96%B9%E6%95%99%E7%A8%8B%20%20%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AF%87%EF%BC%9Aspringboot%E9%9B%86%E6%88%90spring%20cache/"/>
    <id>http://yoursite.com/2018/03/06/SpringBoot非官方教程  第十三篇：springboot集成spring cache/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T07:21:38.185Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>转载请标明出处：<br><a href="http://blog.csdn.net/forezp/article/details/71023614" target="_blank" rel="noopener">http://blog.csdn.net/forezp/article/details/71023614</a><br>本文出自<a href="http://blog.csdn.net/forezp" target="_blank" rel="noopener">方志朋的博客</a></p></blockquote><p>本文介绍如何在springboot中使用默认的spring cache，</p><h2 id="声明式缓存"><a href="#声明式缓存" class="headerlink" title="声明式缓存"></a>声明式缓存</h2><p>Spring 定义 CacheManager 和 Cache 接口用来统一不同的缓存技术。例如 JCache、 EhCache、 Hazelcast、 Guava、 Redis 等。在使用 Spring 集成 Cache 的时候，我们需要注册实现的 CacheManager 的 Bean。</p><p>Spring Boot 为我们自动配置了 JcacheCacheConfiguration、 EhCacheCacheConfiguration、HazelcastCacheConfiguration、GuavaCacheConfiguration、RedisCacheConfiguration、SimpleCacheConfiguration 等。</p><h2 id="默认使用-ConcurrenMapCacheManager"><a href="#默认使用-ConcurrenMapCacheManager" class="headerlink" title="默认使用 ConcurrenMapCacheManager"></a>默认使用 ConcurrenMapCacheManager</h2><p>在我们不使用其他第三方缓存依赖的时候，springboot自动采用ConcurrenMapCacheManager作为缓存管理器。</p><h2 id="环境依赖"><a href="#环境依赖" class="headerlink" title="环境依赖"></a>环境依赖</h2><p>在pom文件引入spring-boot-starter-cache环境依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="创建一个book数据访问层"><a href="#创建一个book数据访问层" class="headerlink" title="创建一个book数据访问层"></a>创建一个book数据访问层</h2><h3 id="先创建一个实体类"><a href="#先创建一个实体类" class="headerlink" title="先创建一个实体类"></a>先创建一个实体类</h3><p>“`</p><p>public class Book {</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String isbn;</span><br><span class="line"><span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">(String isbn, String title)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.isbn = isbn;</span><br><span class="line">    <span class="keyword">this</span>.title = title;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>….getter<br>….setter</p><p>}</p><h3 id="创建一个数据访问接口"><a href="#创建一个数据访问接口" class="headerlink" title="创建一个数据访问接口"></a>创建一个数据访问接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Book <span class="title">getByIsbn</span><span class="params">(String isbn)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个你可以写一个很复杂的数据查询操作，比如操作mysql、nosql等等。为了演示这个栗子，我只做了一下线程的延迟操作，当作是查询数据库的时间。</p><p>实现接口类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleBookRepository</span> <span class="keyword">implements</span> <span class="title">BookRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getByIsbn</span><span class="params">(String isbn)</span> </span>&#123;</span><br><span class="line">        simulateSlowService();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Book(isbn, <span class="string">"Some book"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Don't do this at home</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">simulateSlowService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> time = <span class="number">3000L</span>;</span><br><span class="line">            Thread.sleep(time);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppRunner</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(AppRunner.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookRepository bookRepository;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AppRunner</span><span class="params">(BookRepository bookRepository)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookRepository = bookRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        logger.info(<span class="string">".... Fetching books"</span>);</span><br><span class="line">        logger.info(<span class="string">"isbn-1234 --&gt;"</span> + bookRepository.getByIsbn(<span class="string">"isbn-1234"</span>));</span><br><span class="line">        logger.info(<span class="string">"isbn-4567 --&gt;"</span> + bookRepository.getByIsbn(<span class="string">"isbn-4567"</span>));</span><br><span class="line">        logger.info(<span class="string">"isbn-1234 --&gt;"</span> + bookRepository.getByIsbn(<span class="string">"isbn-1234"</span>));</span><br><span class="line">        logger.info(<span class="string">"isbn-4567 --&gt;"</span> + bookRepository.getByIsbn(<span class="string">"isbn-4567"</span>));</span><br><span class="line">        logger.info(<span class="string">"isbn-1234 --&gt;"</span> + bookRepository.getByIsbn(<span class="string">"isbn-1234"</span>));</span><br><span class="line">        logger.info(<span class="string">"isbn-1234 --&gt;"</span> + bookRepository.getByIsbn(<span class="string">"isbn-1234"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动程序，你会发现程序在控制台依次打印了：</p><blockquote><p>2014-06-05 12:15:35.783 … : …. Fetching books</p><p>2014-06-05 12:15:40.783 … : isbn-1234 –&gt; &gt;Book{isbn=’isbn-1234’, title=’Some book’}</p><p>2014-06-05 12:15:43.784 … : isbn-1234 –&gt;Book{isbn=’isbn-1234’, title=’Some book’}</p><p>2014-06-05 12:15:46.786 … : isbn-1234 –&gt;Book{isbn=’isbn-1234’, title=’Some book’}</p></blockquote><p>你会发现程序依次3s打印一行日志。这时还没开启缓存技术。</p><h2 id="开启缓存技术"><a href="#开启缓存技术" class="headerlink" title="开启缓存技术"></a>开启缓存技术</h2><p>在程序的入口中加入@ EnableCaching开启缓存技术：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在需要缓存的地方加入@Cacheable注解，比如在getByIsbn（）方法上加入@Cacheable(“books”)，这个方法就开启了缓存策略，当缓存有这个数据的时候，会直接返回数据，不会等待去查询数据库。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleBookRepository</span> <span class="keyword">implements</span> <span class="title">BookRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Cacheable</span>(<span class="string">"books"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getByIsbn</span><span class="params">(String isbn)</span> </span>&#123;</span><br><span class="line">        simulateSlowService();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Book(isbn, <span class="string">"Some book"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Don't do this at home</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">simulateSlowService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> time = <span class="number">3000L</span>;</span><br><span class="line">            Thread.sleep(time);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这时再启动程序，你会发现程序打印：</p><blockquote><p>isbn-1234 –&gt;Book{isbn=’isbn-1234’, title=’Some book’}<br>2017-04-23 18:17:09.479 INFO 8054 — [ main] forezp.AppRunner : isbn-4567 –&gt;Book{isbn=’isbn-4567’, title=’Some book’}<br>2017-04-23 18:17:09.480 INFO 8054 — [ main] forezp.AppRunner : isbn-1234 –&gt;Book{isbn=’isbn-1234’, title=’Some book’}<br>2017-04-23 18:17:09.480 INFO 8054 — [ main] forezp.AppRunner : isbn-4567 –&gt;Book{isbn=’isbn-4567’, title=’Some book’}<br>2017-04-23 18:17:09.481 INFO 8054 — [ main] forezp.AppRunner : isbn-1234 –&gt;Book{isbn=’isbn-1234’, title=’Some book’}<br>2017-04-23 18:17:09.481 INFO 8054 — [ main] forezp.AppRunner : isbn-1234 –&gt;Book{isbn=’isbn-1234’, title=’Some book’}</p></blockquote><p>只有打印前面2个数据，程序等了3s，之后的数据瞬间打印在控制台上了，这说明缓存起了作用。</p><p>源码下载：<a href="https://github.com/forezp/SpringBootLearning" target="_blank" rel="noopener">https://github.com/forezp/SpringBootLearning</a></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://spring.io/guides/gs/caching/" target="_blank" rel="noopener">caching</a></p><p><a href="http://blog.720ui.com/2017/springboot_02_data_cache_concurrenmapcache/" target="_blank" rel="noopener">Spring Boot 揭秘与实战（二） 数据缓存篇 - 快速入门</a></p><h3 id="优秀文章推荐："><a href="#优秀文章推荐：" class="headerlink" title="优秀文章推荐："></a>优秀文章推荐：</h3><ul><li>更多springboot 教程：<a href="http://blog.csdn.net/forezp/article/details/70341818" target="_blank" rel="noopener">springBoot非官方教程 | 文章汇总</a></li><li>更多springcoud 教程：<a href="http://blog.csdn.net/forezp/article/details/70148833" target="_blank" rel="noopener">史上最简单的 SpringCloud 教程 | 文章汇总</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;转载请标明出处：&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/forezp/article/details/71023614&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://blog.csdn.n
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="SpringBoot" scheme="http://yoursite.com/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7开放端口和关闭防火墙</title>
    <link href="http://yoursite.com/2018/03/06/CentOS%207%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3%E5%92%8C%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99/"/>
    <id>http://yoursite.com/2018/03/06/CentOS 7开放端口和关闭防火墙/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T07:31:55.500Z</updated>
    
    <content type="html"><![CDATA[<h1 id="开放端口"><a href="#开放端口" class="headerlink" title="开放端口"></a>开放端口</h1><p>永久的开放需要的端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>之后检查新的防火墙规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure><h1 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h1><p>由于只是用于开发环境，所以打算把防火墙关闭掉</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//临时关闭防火墙,重启后会重新自动打开</span><br><span class="line">systemctl restart firewalld</span><br><span class="line">//检查防火墙状态</span><br><span class="line">firewall-cmd --state</span><br><span class="line">firewall-cmd --list-all</span><br><span class="line">//Disable firewall</span><br><span class="line">systemctl disable firewalld</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line">//Enable firewall</span><br><span class="line">systemctl enable firewalld</span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;开放端口&quot;&gt;&lt;a href=&quot;#开放端口&quot; class=&quot;headerlink&quot; title=&quot;开放端口&quot;&gt;&lt;/a&gt;开放端口&lt;/h1&gt;&lt;p&gt;永久的开放需要的端口&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td 
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="Centos 7" scheme="http://yoursite.com/tags/Centos-7/"/>
    
  </entry>
  
  <entry>
    <title>ActiveMQ</title>
    <link href="http://yoursite.com/2018/03/06/ActiveMQ/"/>
    <id>http://yoursite.com/2018/03/06/ActiveMQ/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T07:44:45.431Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ActiveMQ简单的示例"><a href="#ActiveMQ简单的示例" class="headerlink" title="ActiveMQ简单的示例"></a>ActiveMQ简单的示例</h2><h3 id="下载ActiveMQ"><a href="#下载ActiveMQ" class="headerlink" title="下载ActiveMQ"></a>下载ActiveMQ</h3><ul><li>去官方网站下载：<a href="http://activemq.apache.org/" target="_blank" rel="noopener">http://activemq.apache.org/</a></li></ul><h3 id="运行ActiveMQ"><a href="#运行ActiveMQ" class="headerlink" title="运行ActiveMQ"></a>运行ActiveMQ</h3><ol><li><p>解压缩apache-activemq-5.9.0-bin.zip，</p></li><li><p>修改配置文件activeMQ.xml，将0.0.0.0修改为localhost</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">"openwire"</span> <span class="attr">uri</span>=<span class="string">"tcp://localhost:61616"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">"ssl"</span>     <span class="attr">uri</span>=<span class="string">"ssl://localhost:61617"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">"stomp"</span>   <span class="attr">uri</span>=<span class="string">"stomp://localhost:61613"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">uri</span>=<span class="string">"http://localhost:8081"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">uri</span>=<span class="string">"udp://localhost:61618"</span>/&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>然后双击apache-activemq-5.9.0\bin\activemq.bat运行ActiveMQ程序。</p></li><li>启动ActiveMQ以后，登陆：<a href="http://localhost:8161/admin/" target="_blank" rel="noopener">http://localhost:8161/admin/</a>  账号密码：admin</li><li>创建一个Queue，命名为FirstQueue。</li></ol><p><img src="http://ou9crezlk.bkt.clouddn.com/blog/170930/7dhmAb4fD0.png?imageslim" alt="mark"></p><h3 id="点对点"><a href="#点对点" class="headerlink" title="点对点"></a>点对点</h3><ul><li>即一个生产者和一个消费者一一对应</li></ul><h4 id="producer生产者"><a href="#producer生产者" class="headerlink" title="producer生产者"></a>producer生产者</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 1. 创建连接工厂ActiveMQConnectionFactory，需要ip和端口61616</span></span><br><span class="line">ActiveMQConnectionFactory factory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">"tcp://192.168.37.161:61616"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 从连接工厂中创建连接对象</span></span><br><span class="line">Connection connection = factory.createConnection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 执行start方法开启连接</span></span><br><span class="line">connection.start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 从连接中创建session对象</span></span><br><span class="line"><span class="comment">// 第一个参数，是否开启事务，JTA分布式事务</span></span><br><span class="line"><span class="comment">// 第二个参数，是否自动应答，如果第一个参数为true，第二个参数失效</span></span><br><span class="line">Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 从session中创建Destination对象，设置queue名称（有两种类型queue和topic）</span></span><br><span class="line">Queue queue = session.createQueue(<span class="string">"test-queue"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 从session中创建Product对象</span></span><br><span class="line">MessageProducer producer = session.createProducer(queue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. 创建消息对象</span></span><br><span class="line">TextMessage textMessage = <span class="keyword">new</span> ActiveMQTextMessage();</span><br><span class="line"><span class="comment">// 设置消息内容</span></span><br><span class="line">textMessage.setText(<span class="string">"开始发消息！"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. 发送消息</span></span><br><span class="line">producer.send(textMessage);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. 关闭session、连接</span></span><br><span class="line">producer.close();</span><br><span class="line">session.close();</span><br><span class="line">connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="consumer消费者"><a href="#consumer消费者" class="headerlink" title="consumer消费者"></a>consumer消费者</h4><ul><li><p>直接获取消息</p><ul><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 1. 创建连接工厂ActiveMQConnectionFactory，需要ip和端口61616</span></span><br><span class="line">ActiveMQConnectionFactory factory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">"tcp://192.168.37.161:61616"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用工厂创建连接</span></span><br><span class="line">Connection connection = factory.createConnection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 使用start开启连接</span></span><br><span class="line">connection.start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 从连接中创建session对象</span></span><br><span class="line">Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 从session中创建Destination对象，设置queue名字</span></span><br><span class="line">Queue queue = session.createQueue(<span class="string">"test-queue"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 从session中创建Consumer</span></span><br><span class="line">MessageConsumer consumer = session.createConsumer(queue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7， 接收消息,直接获取</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">// 消息超时时间是20秒</span></span><br><span class="line">Message message = consumer.receive(<span class="number">20000</span>);</span><br><span class="line"><span class="comment">// 如果消息为空，则跳出死循环</span></span><br><span class="line"><span class="keyword">if</span> (message == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. 打印消息</span></span><br><span class="line"><span class="keyword">if</span> (message <span class="keyword">instanceof</span> TextMessage) &#123;</span><br><span class="line"><span class="comment">// 获取消息</span></span><br><span class="line">TextMessage textMessage = (TextMessage) message;</span><br><span class="line"><span class="comment">// 打印</span></span><br><span class="line">System.out.println(textMessage.getText());&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. 关闭session、连接等</span></span><br><span class="line">consumer.close();</span><br><span class="line">session.close();</span><br><span class="line">connection.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul></li><li><p>使用监听器</p><ul><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 1. 创建连接工厂ActiveMQConnectionFactory，需要ip和端口61616</span></span><br><span class="line">ActiveMQConnectionFactory factory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">"tcp://192.168.37.161:61616"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用工厂创建连接</span></span><br><span class="line">Connection connection = factory.createConnection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 使用start开启连接</span></span><br><span class="line">connection.start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 从连接中创建session对象</span></span><br><span class="line">Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 从session中创建Destination对象，设置queue名字</span></span><br><span class="line">Queue queue = session.createQueue(<span class="string">"test-queue"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 从session中创建Consumer</span></span><br><span class="line">MessageConsumer consumer = session.createConsumer(queue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// // 7， 接收消息,直接获取</span></span><br><span class="line"><span class="comment">// while (true) &#123;</span></span><br><span class="line"><span class="comment">// // 消息超时时间是20秒</span></span><br><span class="line"><span class="comment">// Message message = consumer.receive(20000);</span></span><br><span class="line"><span class="comment">// // 如果消息为空，则跳出死循环</span></span><br><span class="line"><span class="comment">// if (message == null) &#123;</span></span><br><span class="line"><span class="comment">// break;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// // 8. 打印消息</span></span><br><span class="line"><span class="comment">// if (true) &#123;</span></span><br><span class="line"><span class="comment">// if (message instanceof TextMessage) &#123;</span></span><br><span class="line"><span class="comment">// // 获取消息</span></span><br><span class="line"><span class="comment">// TextMessage textMessage = (TextMessage) message;</span></span><br><span class="line"><span class="comment">// // 打印</span></span><br><span class="line"><span class="comment">// System.out.println(textMessage.getText());</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7.接收消息</span></span><br><span class="line"><span class="comment">// 监听器的方式实际上是开启了一个新的线程，专门处理消息的接受</span></span><br><span class="line"><span class="comment">// 现在的情况是，主线程执行完就结束了，新的线程也跟着没了</span></span><br><span class="line">consumer.setMessageListener(<span class="keyword">new</span> MessageListener() &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (message <span class="keyword">instanceof</span> TextMessage) &#123;</span><br><span class="line"><span class="comment">// 获取消息</span></span><br><span class="line">TextMessage textMessage = (TextMessage) message;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// 打印</span></span><br><span class="line">System.out.println(textMessage.getText());</span><br><span class="line">&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让主线程等待一会，监听器能够有时间执行</span></span><br><span class="line">Thread.sleep(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. 关闭session、连接等</span></span><br><span class="line">consumer.close();</span><br><span class="line">session.close();</span><br><span class="line">connection.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul></li></ul><h3 id="发布-订阅模式"><a href="#发布-订阅模式" class="headerlink" title="发布/订阅模式"></a>发布/订阅模式</h3><ul><li>即一个生产者产生消息并进行发送后，可以由多个消费者进行接收。</li></ul><h4 id="producer生产者-1"><a href="#producer生产者-1" class="headerlink" title="producer生产者"></a>producer生产者</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 1. 创建连接工厂ActiveMQConnectionFactory</span></span><br><span class="line">ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(</span><br><span class="line"><span class="string">"tcp://192.168.37.161:61616"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用工厂创建连接</span></span><br><span class="line">Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 使用start方法开启连接</span></span><br><span class="line">connection.start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 从连接创建session</span></span><br><span class="line">Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 从session创建Destination对象，设置topic名称</span></span><br><span class="line">Topic topic = session.createTopic(<span class="string">"test-topic"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 从session创建Product</span></span><br><span class="line">MessageProducer producer = session.createProducer(topic);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. 创建消息对象</span></span><br><span class="line">TextMessage textMessage = <span class="keyword">new</span> ActiveMQTextMessage();</span><br><span class="line">textMessage.setText(<span class="string">"topic消息"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. 发送消息</span></span><br><span class="line">producer.send(textMessage);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. 关闭session、连接等</span></span><br><span class="line">producer.close();</span><br><span class="line">session.close();</span><br><span class="line">connection.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="consumer消费者-1"><a href="#consumer消费者-1" class="headerlink" title="consumer消费者"></a>consumer消费者</h4><ul><li><p>consumer1</p><ul><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 1. 创建连接工厂ActiveMQConnectionFactory</span></span><br><span class="line">ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(</span><br><span class="line"><span class="string">"tcp://192.168.37.161:61616"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 从连接工厂创建连接</span></span><br><span class="line">Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 使用start方法开启连接</span></span><br><span class="line">connection.start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 从连接创建session对象</span></span><br><span class="line">Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 从session创建安Destination，设置topic名称</span></span><br><span class="line">Topic topic = session.createTopic(<span class="string">"test-topic"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 从session创建Consumer对象</span></span><br><span class="line">MessageConsumer consumer = session.createConsumer(topic);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. 接收消息，直接接受</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">Message message = consumer.receive(<span class="number">20000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (message == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (message <span class="keyword">instanceof</span> TextMessage) &#123;</span><br><span class="line">TextMessage textMessage = (TextMessage) message;</span><br><span class="line"><span class="comment">// 8. 打印消息</span></span><br><span class="line">System.out.println(textMessage.getText());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. 关闭session、消息等</span></span><br><span class="line">consumer.close();</span><br><span class="line">session.close();</span><br><span class="line">connection.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>consumer2</p><ul><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 1. 创建连接工厂ActiveMQConnectionFactory</span></span><br><span class="line">ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(</span><br><span class="line"><span class="string">"tcp://192.168.37.161:61616"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 从连接工厂创建连接</span></span><br><span class="line">Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 使用start方法开启连接</span></span><br><span class="line">connection.start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 从连接创建session对象</span></span><br><span class="line">Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 从session创建安Destination，设置topic名称</span></span><br><span class="line">Topic topic = session.createTopic(<span class="string">"test-topic"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 从session创建Consumer对象</span></span><br><span class="line">MessageConsumer consumer = session.createConsumer(topic);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. 接收消息，直接接受</span></span><br><span class="line"><span class="comment">// while (true) &#123;</span></span><br><span class="line"><span class="comment">// Message message = consumer.receive(20000);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// if (message == null) &#123;</span></span><br><span class="line"><span class="comment">// break;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// if (message instanceof TextMessage) &#123;</span></span><br><span class="line"><span class="comment">// TextMessage textMessage = (TextMessage) message;</span></span><br><span class="line"><span class="comment">// // 8. 打印消息</span></span><br><span class="line"><span class="comment">// System.out.println(textMessage.getText());</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7.接受消息，使用监听器</span></span><br><span class="line">consumer.setMessageListener(<span class="keyword">new</span> MessageListener() &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (message <span class="keyword">instanceof</span> TextMessage) &#123;</span><br><span class="line">TextMessage textMessage = (TextMessage) message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// 打印消息</span></span><br><span class="line">System.out.println(textMessage.getText());</span><br><span class="line">&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待监听器执行</span></span><br><span class="line">Thread.sleep(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. 关闭session、消息等</span></span><br><span class="line">consumer.close();</span><br><span class="line">session.close();</span><br><span class="line">connection.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="整合spring"><a href="#整合spring" class="headerlink" title="整合spring"></a>整合spring</h2><h3 id="加入依赖"><a href="#加入依赖" class="headerlink" title="加入依赖"></a>加入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加入ActiveMQ依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 加入spring-jms依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Spring --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="消息发送"><a href="#消息发送" class="headerlink" title="消息发送"></a>消息发送</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1. 创建spring容器</span></span><br><span class="line">ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line"><span class="string">"applicationContext-activemq.xml"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 从容器中获取JMSTemplate对象</span></span><br><span class="line">JmsTemplate jmsTemplate = context.getBean(JmsTemplate.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 从容器中获取Destination对象</span></span><br><span class="line">Destination destination = context.getBean(Destination.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 使用JMSTemplate发送消息</span></span><br><span class="line">jmsTemplate.send(destination, <span class="keyword">new</span> MessageCreator() &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Message <span class="title">createMessage</span><span class="params">(Session session)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line"><span class="comment">// 创建消息对象</span></span><br><span class="line">TextMessage textMessage = <span class="keyword">new</span> ActiveMQTextMessage();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置消息内容</span></span><br><span class="line">textMessage.setText(<span class="string">"spring整合ActiveMQ"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印消息</span></span><br><span class="line">System.out.println(textMessage.getText());</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> textMessage;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="消息接收"><a href="#消息接收" class="headerlink" title="消息接收"></a>消息接收</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMessageListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (message <span class="keyword">instanceof</span> TextMessage) &#123;</span><br><span class="line">TextMessage textMessage = (TextMessage) message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// 获取消息内容</span></span><br><span class="line">String msg = textMessage.getText();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印消息</span></span><br><span class="line">System.out.println(<span class="string">"接受消息:"</span> + msg);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="queue方式配置spring"><a href="#queue方式配置spring" class="headerlink" title="queue方式配置spring"></a>queue方式配置spring</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span> <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span> <span class="attr">xmlns:jms</span>=<span class="string">"http://www.springframework.org/schema/jms"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 真正可以产生Connection的ConnectionFactory，由对应的 JMS服务厂商提供 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"targetConnectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brokerURL"</span> <span class="attr">value</span>=<span class="string">"tcp://192.168.37.161:61616"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Spring用于管理真正的ConnectionFactory的ConnectionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.connection.SingleConnectionFactory"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 目标ConnectionFactory对应真实的可以产生JMS Connection的ConnectionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetConnectionFactory"</span> <span class="attr">ref</span>=<span class="string">"targetConnectionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Spring提供的JMS工具类，它可以进行消息发送、接收等 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.core.JmsTemplate"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这个connectionFactory对应的是我们定义的Spring提供的那个ConnectionFactory对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--这个是队列目的地，点对点的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"queueDestination"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.command.ActiveMQQueue"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>queue<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--这个是主题目的地，一对多的 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;bean id="topicDestination" class="org.apache.activemq.command.ActiveMQTopic"&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;constructor-arg value="topic" /&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;/bean&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- messageListener实现类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myMessageListener"</span> <span class="attr">class</span>=<span class="string">"cn.itcast.activemq.spring.MyMessageListener"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置一个jsm监听容器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsContainer"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"destination"</span> <span class="attr">ref</span>=<span class="string">"queueDestination"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageListener"</span> <span class="attr">ref</span>=<span class="string">"myMessageListener"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="topic方式配置spring"><a href="#topic方式配置spring" class="headerlink" title="topic方式配置spring"></a>topic方式配置spring</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:jms</span>=<span class="string">"http://www.springframework.org/schema/jms"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 真正可以产生Connection的ConnectionFactory，由对应的 JMS服务厂商提供 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"targetConnectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brokerURL"</span> <span class="attr">value</span>=<span class="string">"tcp://192.168.37.161:61616"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Spring用于管理真正的ConnectionFactory的ConnectionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.jms.connection.SingleConnectionFactory"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 目标ConnectionFactory对应真实的可以产生JMS Connection的ConnectionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetConnectionFactory"</span> <span class="attr">ref</span>=<span class="string">"targetConnectionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Spring提供的JMS工具类，它可以进行消息发送、接收等 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.core.JmsTemplate"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这个connectionFactory对应的是我们定义的Spring提供的那个ConnectionFactory对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--这个是队列目的地，点对点的 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;bean id="queueDestination" class="org.apache.activemq.command.ActiveMQQueue"&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;constructor-arg&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;value&gt;queue&lt;/value&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;/constructor-arg&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;/bean&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--这个是主题目的地，一对多的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"topicDestination"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.command.ActiveMQTopic"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"topic"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- messageListener实现类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myMessageListener"</span> <span class="attr">class</span>=<span class="string">"cn.itcast.activemq.spring.MyMessageListener"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- messageListener实现类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myMessageListener2"</span> <span class="attr">class</span>=<span class="string">"cn.itcast.activemq.spring.MyMessageListener2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置一个jsm监听容器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsContainer"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"destination"</span> <span class="attr">ref</span>=<span class="string">"topicDestination"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageListener"</span> <span class="attr">ref</span>=<span class="string">"myMessageListener"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置一个jsm监听容器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsContainer2"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"destination"</span> <span class="attr">ref</span>=<span class="string">"topicDestination"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageListener"</span> <span class="attr">ref</span>=<span class="string">"myMessageListener2"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ActiveMQ简单的示例&quot;&gt;&lt;a href=&quot;#ActiveMQ简单的示例&quot; class=&quot;headerlink&quot; title=&quot;ActiveMQ简单的示例&quot;&gt;&lt;/a&gt;ActiveMQ简单的示例&lt;/h2&gt;&lt;h3 id=&quot;下载ActiveMQ&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="JMS" scheme="http://yoursite.com/tags/JMS/"/>
    
      <category term="MQ" scheme="http://yoursite.com/tags/MQ/"/>
    
      <category term="ActiveMQ" scheme="http://yoursite.com/tags/ActiveMQ/"/>
    
  </entry>
  
  <entry>
    <title>CentOS6.7最小化安装版安装mysql5.6</title>
    <link href="http://yoursite.com/2018/03/06/CentOS6.7%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%89%E8%A3%85%E7%89%88%E5%AE%89%E8%A3%85mysql5.6/"/>
    <id>http://yoursite.com/2018/03/06/CentOS6.7最小化安装版安装mysql5.6/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T07:44:40.316Z</updated>
    
    <content type="html"><![CDATA[<p>##卸载mysql</p><ul><li>查看是否有mysql软件<ul><li><code>rpm -qa|grep mysql</code></li></ul></li><li>卸载mysql<ul><li>yum remove mysql mysql-server mysql-libs mysql-common</li></ul></li><li>查看是否还有mysql软件，有的话继续删除</li><li>软件卸载完毕后如果需要可以删除mysql的数据库：<ul><li><code>rm -rf /var/lib/mysql</code></li></ul></li><li>使用RPM命令删除</li><li>rpm -qa | grep mysql<blockquote><p>mysql-libs-5.1.71-1.el6.i686</p></blockquote></li><li><code>rpm -e mysql-libs-5.1.71-1.el6.i686 --nodeps</code></li><li>删除原来的数据库文件mysql的数据文件存放在 /var/lib/mysql,删除即可</li></ul><p>##RPM包安装</p><p>###下载RPM包</p><ul><li>MySQL-5.6.27-1.linux_glibc2.5.x86_64.rpm-bundle.tar</li><li>上传到服务器</li><li>解压 ：<ul><li><code>tar -xvf MySQL-5.6.27-1.linux_glibc2.5.x86_64.rpm-bundle.tar</code></li></ul></li><li><img src="http://ou9crezlk.bkt.clouddn.com/blog/170906/9a9DhibB92.png" alt="mark"><br>###安装server</li><li><code>rpm -ivh MySQL-server-5.6.27-1.linux_glibc2.5.x86_64.rpm</code><br><img src="http://ou9crezlk.bkt.clouddn.com/blog/170906/acgG4D5fj4.png" alt="mark"></li><li>依赖问题解决<ul><li><code>yum install libaio</code></li></ul></li><li>再次执行<ul><li><code>rpm -ivh MySQL-server-5.6.27-1.linux_glibc2.5.x86_64.rpm</code></li></ul></li><li><img src="http://ou9crezlk.bkt.clouddn.com/blog/170906/17Bj3fJ6Gf.png" alt="mark"></li><li>提示root用户随机生成的密码保存的文件</li><li>查看随机生成的密码：<ul><li><code>cat /root/.mysql_secret</code></li><li><img src="http://ou9crezlk.bkt.clouddn.com/blog/170906/lJk03k1Ehh.png" alt="mark"></li></ul></li></ul><p>##安装client</p><ul><li><code>rpm -ivh MySQL-client-5.6.27-1.linux_glibc2.5.x86_64.rpm</code></li><li>启动mysql<ul><li><code>service mysql start</code></li></ul></li><li>使用随机生成的密码登录<ul><li><code>mysql -u root -p</code></li></ul></li></ul><p>##修改密码</p><ul><li>set password=password(“root”)</li></ul><p>##设置远程访问权限</p><p>###改表法 </p><p>可能是你的帐号不允许从远程登陆，只能在localhost。这个时候只要在localhost的那台电脑，登入mysql后，更改 “mysql” 数据库里的 “user” 表里的 “host” 项，从”localhost”改称”%” </p><blockquote><p>mysql -u root -p<br>mysql&gt;use mysql;<br>mysql&gt;update user set host = ‘%’ where user = ‘root’;<br>mysql&gt;select host, user from user; </p></blockquote><p>###授权法 </p><ul><li>运行： <ul><li><code>mysqy -u root -p</code> </li></ul></li><li>赋予任何主机访问数据的权限<ul><li><code>GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39;WITH GRANT OPTION</code></li></ul></li><li>例如，你想myuser使用mypassword从任何主机连接到mysql服务器的话。 <ul><li><code>GRANT ALL PRIVILEGES ON *.* TO &#39;myuser&#39;@&#39;%&#39;IDENTIFIED BY &#39;mypassword&#39; WITH GRANT OPTION</code>; </li></ul></li><li>如果你想允许用户myuser从ip为192.168.1.6的主机连接到mysql服务器，并使用mypassword作为密码<ul><li><code>GRANT ALL PRIVILEGES ON *.* TO &#39;myuser&#39;@&#39;192.168.1.3&#39;IDENTIFIED BY &#39;mypassword&#39; WITH GRANT OPTION;</code> </li></ul></li><li>修改生效<ul><li><code>FLUSH PRIVILEGES</code> </li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##卸载mysql&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;查看是否有mysql软件&lt;ul&gt;
&lt;li&gt;&lt;code&gt;rpm -qa|grep mysql&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;卸载mysql&lt;ul&gt;
&lt;li&gt;yum remove mysql mysql-s
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="Centos 6" scheme="http://yoursite.com/tags/Centos-6/"/>
    
      <category term="Mysql" scheme="http://yoursite.com/tags/Mysql/"/>
    
  </entry>
  
  <entry>
    <title>HADOOP集群搭建</title>
    <link href="http://yoursite.com/2018/03/06/HADOOP%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"/>
    <id>http://yoursite.com/2018/03/06/HADOOP集群搭建/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T07:33:05.260Z</updated>
    
    <content type="html"><![CDATA[<ul><li><h1 id="HADOOP集群搭建"><a href="#HADOOP集群搭建" class="headerlink" title="HADOOP集群搭建"></a>HADOOP集群搭建</h1><h1 id="集群简介"><a href="#集群简介" class="headerlink" title="集群简介"></a>集群简介</h1><blockquote><ul><li>HADOOP集群具体来说包含两个集群：HDFS集群和YARN集群，两者逻辑上分离，但物理上常在一起</li></ul><ul><li>HDFS集群：<ul><li>负责海量数据的存储，集群中的角色主要有 NameNode / DataNode</li></ul></li><li>YARN集群：<ul><li>负责海量数据运算时的资源调度，集群中的角色主要有 ResourceManager /NodeManager</li></ul></li></ul><p><strong>(那mapreduce是什么呢？它其实是一个应用程序开发包)</strong></p></blockquote><p>​</p><h2 id="服务器准备"><a href="#服务器准备" class="headerlink" title="服务器准备"></a>服务器准备</h2><p>本案例使用虚拟机服务器来搭建HADOOP集群，</p><ul><li>服务器节点数量：3</li></ul></li></ul><ul><li><p>所用软件及版本：</p><ul><li>Vmware 11.0</li><li>Centos  6.5  64bit</li></ul><h2 id="网络环境准备"><a href="#网络环境准备" class="headerlink" title="网络环境准备"></a>网络环境准备</h2></li><li><p>采用NAT方式联网</p></li><li>网关地址：192.168.127.1</li><li>3个服务器节点IP地址：192.168.127.61、192.168.127.62、192.168.127.63</li><li><p>子网掩码：255.255.255.0</p><h2 id="服务器系统设置"><a href="#服务器系统设置" class="headerlink" title="服务器系统设置"></a>服务器系统设置</h2></li></ul><ol><li><p>添加HADOOP用户  useradd hadoop</p><ol><li><p>为HADOOP用户分配sudoer权限vi /etc/sudoers </p></li><li><blockquote><p>hadoop    ALL=(ALL)       ALL</p></blockquote></li></ol></li><li><p>同步时间</p></li><li><p>设置主机名</p><ol><li><blockquote><p>mini1</p><p>mini2</p><p>mini3</p></blockquote></li></ol></li><li><p>配置内网域名映射</p><ol><li><p><code>vi /etc/hosts</code></p></li><li><blockquote><p>192.168.127.61          mini1</p><p>192.168.127.62          mini2</p><p>192.168.127.63          mini3</p></blockquote></li></ol></li><li><p>配置ssh免密登陆</p></li><li><p>配置防火墙</p><h2 id="JDK环境安装"><a href="#JDK环境安装" class="headerlink" title="JDK环境安装"></a>JDK环境安装</h2></li></ol><ul><li>上传jdk安装包</li><li>解压安装包</li><li><p>配置环境变量 /etc/profile</p><h2 id="HADOOP安装部署"><a href="#HADOOP安装部署" class="headerlink" title="HADOOP安装部署"></a>HADOOP安装部署</h2></li><li><p>上传HADOOP安装包<strong>(Hadoop需要编译。Hadoop是使用Java语言开发的，但是有一些需求和操作并不适合使用java，所以就引入了本地库（Native Libraries）的概念)</strong></p></li><li><p>从<a href="https://link.jianshu.com/?t=http://hadoop.apache.org/releases.html" target="_blank" rel="noopener">http://hadoop.apache.org/releases.html</a>找到一个你想要的版本，下载binary包</p></li><li><p>规划安装目录  /home/hadoop/apps/hadoop-2.9.0</p></li><li><p>解压安装包</p><ul><li><code>tar -zxvf hadoop-2.9.0.tar.gz</code></li></ul></li><li><p>修改  <code>$HADOOP_HOME/etc/hadoop/</code>下的配置文件</p><ul><li><p>最简化配置如下:</p></li><li><p><code>vi  hadoop-env.sh</code></p><ul><li><blockquote><p># The java implementation to use.</p><p>export JAVA_HOME=/home/hadoop/apps/jdk1.7.0_65</p></blockquote></li></ul></li><li><p><code>vi  core-site.xml</code></p><ul><li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://mini1:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 指定hadoop运行时产生文件的存储目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/hdpdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>vi  hdfs-site.xml</code></p><ul><li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定HDFS副本的数量 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>vi  mapred-site.xml</code></p><ul><li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定mr运行在yarn上 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>vi  yarn-site.xml</code></p><ul><li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Site specific YARN configuration properties --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 指定YARN的老大（ResourceManager）的地址 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>mini1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- reducer获取数据的方式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>vi slaves</code></p><ul><li><blockquote><p>mini2</p><p>mini3</p></blockquote></li></ul></li></ul><h2 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h2></li><li><p>将配置好的hadoop文件夹复制到其他节点机器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r ~/apps hadoop@mini2:~/</span><br><span class="line">scp -r ~/apps hadoop@mini3:~/</span><br></pre></td></tr></table></figure></li><li><p>初始化HDFS(mini1机器)</p><ul><li><code>/home/hadoop/apps/hadoop-2.9.0/bin/hadoop namenode -format</code></li></ul></li><li><p>启动HDFS(mini1机器)</p><ul><li><p><code>/home/hadoop/apps/hadoop-2.9.0/sbin/start-dfs.sh</code></p></li><li><p><code>jps</code>命令检查是否启动成功</p><ul><li><blockquote><p>2136 SecondaryNameNode</p><p>2257 Jps</p><p>1792 NameNode</p></blockquote></li></ul></li></ul></li><li><p>启动YARN(mini1机器)</p><ul><li><p><code>/home/hadoop/apps/hadoop-2.6.4/sbin/start-yarn.sh</code></p></li><li><p><code>jps</code>命令检查是否启动成功</p><ul><li><blockquote><p>2306 ResourceManager</p><p>2621 Jps</p><p>2408 NodeManager</p><p>2136 SecondaryNameNode</p><p>1792 NameNode</p></blockquote></li></ul></li></ul></li><li><p>访问控制台<a href="http://mini1:50070" target="_blank" rel="noopener">http://mini1:50070</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;&lt;h1 id=&quot;HADOOP集群搭建&quot;&gt;&lt;a href=&quot;#HADOOP集群搭建&quot; class=&quot;headerlink&quot; title=&quot;HADOOP集群搭建&quot;&gt;&lt;/a&gt;HADOOP集群搭建&lt;/h1&gt;&lt;h1 id=&quot;集群简介&quot;&gt;&lt;a href=&quot;#集群简介&quot; cl
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="Hadoop" scheme="http://yoursite.com/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>CentOS64位下python2.6升级到2.7的详细教程</title>
    <link href="http://yoursite.com/2018/03/06/CentOS64%E4%BD%8D%E4%B8%8Bpython2.6%E5%8D%87%E7%BA%A7%E5%88%B02.7%E7%9A%84%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/"/>
    <id>http://yoursite.com/2018/03/06/CentOS64位下python2.6升级到2.7的详细教程/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T07:32:30.243Z</updated>
    
    <content type="html"><![CDATA[<p>1）安装devtoolset</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall &quot;Development tools&quot;</span><br></pre></td></tr></table></figure><p>2）</p><p>安装编译Python需要的包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install zlib-devel</span><br><span class="line">yum install bzip2-devel</span><br><span class="line">yum install openssl-devel</span><br><span class="line">yum install ncurses-devel</span><br><span class="line">yum install sqlite-devel</span><br></pre></td></tr></table></figure><p>3）下载并解压Python 2.7.9的源代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">wget --no-check-certificate https://www.python.org/ftp/python/2.7.9/Python-2.7.9.tar.xz</span><br><span class="line">tar xf Python-2.7.9.tar.xz</span><br><span class="line">cd Python-2.7.9</span><br></pre></td></tr></table></figure><p>4）编译与安装Python 2.7.9</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local</span><br><span class="line">make &amp;&amp; make altinstall</span><br></pre></td></tr></table></figure><p>5）配置软连接，让系统pyhon默认指向python2.7.9</p><p>mv /usr/bin/python /usr/bin/python2.6_temp</p><p>ln -s /usr/local/bin/python2.7 /usr/bin/python</p><p>python -V # 查看Python 2.7.9</p><p>6）yum与python2.7不兼容，修改yum文件</p><p>vi /usr/bin/yum</p><p>将”!/usr/bin/python”改为”!/usr/bin/python2.6”</p><p>7）配置环境变量</p><p>vi /etc/profile</p><p># 添加如下内容：</p><p>PY_HOME=/usr/local/bin/python2.7</p><p>export PATH=\$PY_HOME/bin:$PATH</p><p>8）启动环境变量配置</p><p>source /etc/profile # 当前终端生效，reboot后才会完全生效</p><p>echo $PATH #查看环境变量中是否包含python路径</p><p>9）完美升级完成</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;1）安装devtoolset&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="Centos 6" scheme="http://yoursite.com/tags/Centos-6/"/>
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>HDFS学习</title>
    <link href="http://yoursite.com/2018/03/06/HDFS%E5%AD%A6%E4%B9%A0/"/>
    <id>http://yoursite.com/2018/03/06/HDFS学习/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T07:33:12.122Z</updated>
    
    <content type="html"><![CDATA[<h2 id="HDFS前言"><a href="#HDFS前言" class="headerlink" title="HDFS前言"></a>HDFS前言</h2><ul><li>设计思想<ul><li>分而治之：将大文件、大批量文件，分布式存放在大量服务器上，<strong>以便于采取分而治之的方式对海量数据进行运算分析</strong>； </li></ul></li></ul><ul><li>在大数据系统中作用：<ul><li>为各类分布式运算框架（如：mapreduce，spark，tez，……）提供数据存储服务</li></ul></li><li>重点概念：文件切块，副本存放，元数据</li></ul><h2 id="HDFS的概念和特性"><a href="#HDFS的概念和特性" class="headerlink" title="HDFS的概念和特性"></a>HDFS的概念和特性</h2><ul><li><strong>首先，它是一个文件系统</strong>，用于存储文件，通过统一的命名空间——目录树来定位文件</li><li><strong>其次，它是分布式的</strong>，由很多服务器联合起来实现其功能，集群中的服务器有各自的角色；</li><li><p><strong>重要特性如下：</strong></p><ol><li>HDFS中的文件在物理上是<strong>分块存储（block）</strong>，块的大小可以通过配置参数( dfs.blocksize)来规定，默认大小在hadoop2.x版本中是128M，老版本中是64M</li><li>HDFS文件系统会给客户端提供一个<strong>统一的抽象目录树</strong>，客户端通过路径来访问文件，形如：hdfs://namenode:port/dir-a/dir-b/dir-c/file.data</li><li><strong>目录结构及文件分块信息(元数据)</strong>的管理由namenode节点承担——namenode是HDFS集群主节点，负责维护整个hdfs文件系统的目录树，以及每一个路径（文件）所对应的block块信息（block的id，及所在的datanode服务器）</li><li>文件的各个block的存储管理由datanode节点承担—- datanode是HDFS集群从节点，每一个block都可以在多个datanode上存储多个副本（副本数量也可以通过参数设置dfs.replication）</li><li>HDFS是设计成适应一次写入，多次读出的场景，且不支持文件的修改</li></ol><p><strong>(注：适合用来做数据分析，并不适合用来做网盘应用，因为，不便修改，延迟大，网络开销大，成本太高)</strong></p></li></ul><h2 id="HDFS的shell-命令行客户端-操作"><a href="#HDFS的shell-命令行客户端-操作" class="headerlink" title="HDFS的shell(命令行客户端)操作"></a>HDFS的shell(命令行客户端)操作</h2><h3 id="HDFS命令行客户端使用操作"><a href="#HDFS命令行客户端使用操作" class="headerlink" title="HDFS命令行客户端使用操作"></a>HDFS命令行客户端使用操作</h3><ul><li><code>hadoop fs -ls /</code></li></ul><h3 id="常用命令参数介绍"><a href="#常用命令参数介绍" class="headerlink" title="常用命令参数介绍"></a>常用命令参数介绍</h3><table><thead><tr><th style="text-align:left">命令</th><th>功能</th><th>示例</th></tr></thead><tbody><tr><td style="text-align:left">-help</td><td>输出这个命令参数手册</td><td></td></tr><tr><td style="text-align:left">-ls</td><td>显示目录信息</td><td><code>hadoop fs -ls /</code></td></tr><tr><td style="text-align:left">-mkdir</td><td>在hdfs上创建目录</td><td><code>hadoop fs  -mkdir  -p  /aaa/bbb/cc/dd</code></td></tr><tr><td style="text-align:left">-moveFromLocal</td><td>从本地剪切粘贴到hdfs</td><td><code>hadoop fs -moveFromLocal /home/hadoop/a.txt  /aaa/bbb/cc/dd</code></td></tr><tr><td style="text-align:left">-moveToLocal</td><td>从hdfs剪切粘贴到本地</td><td><code>hadoop fs -moveToLocal  /aaa/bbb/cc/dd  /home/hadoop/a.txt</code></td></tr><tr><td style="text-align:left">-appendToFile</td><td>追加一个文件到已经存在的文件末尾</td><td><code>Hadoop  fs  -appendToFile  ./hello.txt /hello.txt</code></td></tr><tr><td style="text-align:left">-cat</td><td>显示文件内容</td><td><code>hadoop fs -cat  /hello.txt</code></td></tr><tr><td style="text-align:left">-tail</td><td>显示一个文件的末尾</td><td><code>hadoop  fs  -tail  /weblog/access_log.1</code></td></tr><tr><td style="text-align:left">-text</td><td>以字符形式打印一个文件的内容</td><td><code>hadoop  fs  -text  /weblog/access_log.1</code></td></tr><tr><td style="text-align:left">-chgrp</td><td>linux文件系统中的用法一样，对文件所属权限</td><td></td></tr><tr><td style="text-align:left">-chmod</td><td>linux文件系统中的用法一样，对文件所属权限</td><td><code>hadoop  fs  -chmod  666  /hello.txt</code></td></tr><tr><td style="text-align:left">-chown</td><td>linux文件系统中的用法一样，对文件所属权限</td><td><code>hadoop  fs  -chown  someuser:somegrp   /hello.txt</code></td></tr><tr><td style="text-align:left">-copyFromLocal</td><td>从本地文件系统中拷贝文件到hdfs路径去</td><td><code>hadoop  fs  -copyFromLocal  ./jdk.tar.gz  /aaa/</code></td></tr><tr><td style="text-align:left">-copyToLocal</td><td>从hdfs拷贝到本地</td><td><code>hadoop fs -copyToLocal /aaa/jdk.tar.gz</code></td></tr><tr><td style="text-align:left">-cp</td><td>从hdfs的一个路径拷贝hdfs的另一个路径</td><td><code>hadoop  fs  -cp  /aaa/jdk.tar.gz  /bbb/jdk.tar.gz.2</code></td></tr><tr><td style="text-align:left">-mv</td><td>在hdfs目录中移动文件</td><td><code>hadoop  fs  -mv  /aaa/jdk.tar.gz  /</code></td></tr><tr><td style="text-align:left">-get</td><td>等同于copyToLocal，就是从hdfs下载文件到本地</td><td><code>hadoop fs -get  /aaa/jdk.tar.gz</code></td></tr><tr><td style="text-align:left">-getmerge</td><td>合并下载多个文件</td><td><code>hadoop fs -getmerge /aaa/log.* ./log.sum</code></td></tr><tr><td style="text-align:left">-put</td><td>等同于copyFromLocal</td><td><code>hadoop  fs  -put  /aaa/jdk.tar.gz  /bbb/jdk.tar.gz.2</code></td></tr><tr><td style="text-align:left">-rm</td><td>删除文件或文件夹</td><td><code>hadoop fs -rm -r /aaa/bbb/</code></td></tr><tr><td style="text-align:left">-rmdir</td><td>删除空目录</td><td><code>hadoop  fs  -rmdir   /aaa/bbb/ccc</code></td></tr><tr><td style="text-align:left">-df</td><td>统计文件系统的可用空间信息</td><td><code>hadoop  fs  -df  -h  /</code></td></tr><tr><td style="text-align:left">-du</td><td>统计文件夹的大小信息</td><td><code>hadoop  fs  -du  -s  -h /aaa/*</code></td></tr><tr><td style="text-align:left">-count</td><td>统计一个指定目录下的文件节点数量</td><td><code>hadoop fs -count /aaa/</code></td></tr><tr><td style="text-align:left">-setrep</td><td>设置hdfs中文件的副本数量</td><td>`hadoop fs -setrep 3 /aaa/jdk.tar.gz</td></tr></tbody></table><h2 id="HDFS原理篇"><a href="#HDFS原理篇" class="headerlink" title="HDFS原理篇"></a>HDFS原理篇</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ol><li>HDFS集群分为两大角色：NameNode、DataNode  (Secondary Namenode)</li><li>NameNode负责管理整个文件系统的元数据</li><li>DataNode 负责管理用户的文件数据块</li><li>文件会按照固定的大小（blocksize）切成若干块后分布式存储在若干台datanode上</li><li>每一个文件块可以有多个副本，并存放在不同的datanode上</li><li>Datanode会定期向Namenode汇报自身所保存的文件block信息，而namenode则会负责保持文件的副本数量</li><li>HDFS的内部工作机制对客户端保持透明，客户端请求访问HDFS都是通过向namenode申请来进行</li></ol><h3 id="HDFS写数据流程"><a href="#HDFS写数据流程" class="headerlink" title="HDFS写数据流程"></a>HDFS写数据流程</h3><ul><li>客户端要向HDFS写数据，首先要跟namenode通信以确认可以写文件并获得接收文件block的datanode，然后，客户端按顺序将文件逐个block传递给相应datanode，并由接收到block的datanode负责向其他datanode复制block的副本</li></ul><p>####详细步骤图</p><p>  ​</p><ul><li><img src="http://ou9crezlk.bkt.clouddn.com/blog/171023/Gi2l8jkCh6.png?imageslim" alt="mark"></li></ul><p>####详细步骤解析</p><ol><li>根namenode通信请求上传文件，namenode检查目标文件是否已存在，父目录是否存在</li><li>namenode返回是否可以上传</li><li>client请求第一个 block该传输到哪些datanode服务器上</li><li>namenode返回3个datanode服务器ABC</li><li>client请求3台dn中的一台A上传数据（本质上是一个RPC调用，建立pipeline），A收到请求会继续调用B，然后B调用C，将真个pipeline建立完成，逐级返回客户端</li><li>client开始往A上传第一个block（先从磁盘读取数据放到一个本地内存缓存），以packet为单位，A收到一个packet就会传给B，B传给C；A每传一个packet会放入一个应答队列等待应答</li><li>当一个block传输完成之后，client再次请求namenode上传第二个block的服务器。</li></ol><h3 id="HDFS读数据流程"><a href="#HDFS读数据流程" class="headerlink" title="HDFS读数据流程"></a>HDFS读数据流程</h3><ul><li>客户端将要读取的文件路径发送给namenode，namenode获取文件的元信息（主要是block的存放位置信息）返回给客户端，客户端根据返回的信息找到相应datanode逐个获取文件的block并在客户端本地进行数据追加合并从而获得整个文件</li></ul><h4 id="详细步骤图"><a href="#详细步骤图" class="headerlink" title="详细步骤图"></a>详细步骤图</h4><p><img src="http://ou9crezlk.bkt.clouddn.com/blog/171023/9E10iECID7.png?imageslim" alt="mark"></p><h4 id="详细步骤解析"><a href="#详细步骤解析" class="headerlink" title="详细步骤解析"></a>详细步骤解析</h4><ol><li>跟namenode通信查询元数据，找到文件块所在的datanode服务器</li><li>挑选一台datanode（就近原则，然后随机）服务器，请求建立socket流</li><li>datanode开始发送数据（从磁盘里面读取数据放入流，以packet为单位来做校验）</li><li>客户端以packet为单位接收，现在本地缓存，然后写入目标文件</li></ol><h3 id="NAMENODE工作机制"><a href="#NAMENODE工作机制" class="headerlink" title="NAMENODE工作机制"></a>NAMENODE工作机制</h3><p>问题场景：</p><ol><li>集群启动后，可以查看文件，但是上传文件时报错，打开web页面可看到namenode正处于safemode状态，怎么处理？</li><li>Namenode服务器的磁盘故障导致namenode宕机，如何挽救集群及数据？</li><li>Namenode是否可以有多个？namenode内存要配置多大？namenode跟集群数据存储能力有关系吗？</li><li>文件的blocksize究竟调大好还是调小好？</li></ol><h4 id="NAMENODE职责"><a href="#NAMENODE职责" class="headerlink" title="NAMENODE职责"></a>NAMENODE职责</h4><ul><li>NAMENODE职责：<ul><li>负责客户端请求的响应</li><li>元数据的管理（查询，修改）</li></ul></li></ul><h4 id="元数据管理"><a href="#元数据管理" class="headerlink" title="元数据管理"></a>元数据管理</h4><ul><li>namenode对数据的管理采用了三种存储形式：<ul><li>内存元数据(NameSystem)</li><li>磁盘元数据镜像文件</li><li>数据操作日志文件（可通过日志运算出元数据）</li></ul></li></ul><h4 id="元数据存储机制"><a href="#元数据存储机制" class="headerlink" title="元数据存储机制"></a>元数据存储机制</h4><ul><li>内存中有一份完整的元数据(内存meta data)</li><li>磁盘有一个“准完整”的元数据镜像（fsimage）文件(在namenode的工作目录中)</li><li>用于衔接内存metadata和持久化元数据镜像fsimage之间的操作日志（edits文件）注：当客户端对hdfs中的文件进行新增或者修改操作，操作记录首先被记入edits日志文件中，当客户端操作成功后，相应的元数据会更新到内存meta.data中</li></ul><h4 id="元数据手动查看"><a href="#元数据手动查看" class="headerlink" title="元数据手动查看"></a>元数据手动查看</h4><ul><li>可以通过hdfs的一个工具来查看edits中的信息<ul><li>bin/hdfs oev -i edits -o edits.xml</li><li>bin/hdfs oiv -i fsimage_0000000000000000087 -p XML -o fsimage.xml</li></ul></li></ul><h4 id="元数据的checkpoint"><a href="#元数据的checkpoint" class="headerlink" title="元数据的checkpoint"></a>元数据的checkpoint</h4><ul><li>每隔一段时间，会由secondary namenode将namenode上积累的所有edits和一个最新的fsimage下载到本地，并加载到内存进行merge（这个过程称为checkpoint）</li><li>checkpoint的详细过程图</li></ul><p><img src="http://ou9crezlk.bkt.clouddn.com/blog/171023/BaHlDK0493.png?imageslim" alt="mark"></p><ul><li><p>checkpoint操作的触发条件配置参数</p><blockquote><p>dfs.namenode.checkpoint.check.period=60  #检查触发条件是否满足的频率，60秒</p></blockquote><p>dfs.namenode.checkpoint.dir=file://${hadoop.tmp.dir}/dfs/namesecondary</p><p>#以上两个参数做checkpoint操作时，secondary namenode的本地工作目录</p><p>dfs.namenode.checkpoint.edits.dir=${dfs.namenode.checkpoint.dir}</p><p>dfs.namenode.checkpoint.max-retries=3  #最大重试次数<br>dfs.namenode.checkpoint.period=3600  #两次checkpoint之间的时间间隔3600秒<br>dfs.namenode.checkpoint.txns=1000000 #两次checkpoint之间最大的操作记录</p></li><li><p>checkpoint的附带作用</p></li><li><p>namenode和secondary namenode的工作目录存储结构完全相同，所以，当namenode故障退出需要重新恢复时，可以从secondary namenode的工作目录中将fsimage拷贝到namenode的工作目录，以恢复namenode的元数据</p></li></ul><h4 id="元数据目录说明"><a href="#元数据目录说明" class="headerlink" title="元数据目录说明"></a>元数据目录说明</h4><ul><li><p>在第一次部署好Hadoop集群的时候，我们需要在NameNode（NN）节点上格式化磁盘\$HADOOP_HOME/bin/hdfs namenode -format格式化完成之后，将会在$dfs.namenode.name.dir/current目录下如下的文件结构:</p><ul><li><blockquote><p>current/</p><p>|– VERSION</p><p>|– edits_*_</p><p>_|– fsimage_0000000000008547077</p><p>|– fsimage_0000000000008547077.md5</p><p>|– seen_txid</p></blockquote></li></ul></li><li><p>其中的dfs.name.dir是在hdfs-site.xml文件中配置的，默认值如下:</p><ul><li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/dfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>hadoop.tmp.dir是在core-site.xml中配置的，默认值如下:</p><ul><li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>/tmp/hadoop-$&#123;user.name&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>A base for other temporary directories.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>dfs.namenode.name.dir属性可以配置多个目录</p><ul><li>如：/data1/dfs/name,/data2/dfs/name,/data3/dfs/name,….。各个目录存储的文件结构和内容都完全一样，相当于备份，这样做的好处是当其中一个目录损坏了，也不会影响到Hadoop的元数据，特别是当其中一个目录是NFS（网络文件系统Network File System，NFS）之上，即使你这台机器损坏了，元数据也得到保存。</li></ul></li><li><p>下面对$dfs.namenode.name.dir/current/目录下的文件进行解释。</p><ul><li><p>VERSION文件是Java属性文件，内容大致如下：</p></li><li><blockquote><p>#Fri Nov 15 19:47:46 CST 2013</p><p>namespaceID=934548976<br>clusterID=CID-cdff7d73-93cd-4783-9399-0a22e6dce196<br>cTime=0<br>storageType=NAME_NODE<br>blockpoolID=BP-893790215-192.168.24.72-1383809616115<br>layoutVersion=-47</p></blockquote></li><li><p>namespaceID是文件系统的唯一标识符，在文件系统首次格式化之后生成的；</p></li><li><p>storageType说明这个文件存储的是什么进程的数据结构信息（如果是DataNode，storageType=DATA_NODE）；</p></li><li><p>cTime表示NameNode存储时间的创建时间，由于我的NameNode没有更新过，所以这里的记录值为0，以后对NameNode升级之后，cTime将会记录更新时间戳；</p></li><li><p>layoutVersion表示HDFS永久性数据结构的版本信息， 只要数据结构变更，版本号也要递减，此时的HDFS也需要升级，否则磁盘仍旧是使用旧版本的数据结构，这会导致新版本的NameNode无法使用；</p></li><li><p>clusterID是系统生成或手动指定的集群ID，在-clusterid选项中可以使用它；如下说明</p><ul><li>使用如下命令格式化一个Namenode：<ul><li><code>$HADOOP_HOME/bin/hdfs namenode -format [-clusterId &lt;cluster_id&gt;]</code><br>选择一个唯一的cluster_id，并且这个cluster_id不能与环境中其他集群有冲突。如果没有提供cluster_id，则会自动生成一个唯一的ClusterID。</li></ul></li><li>使用如下命令格式化其他Namenode<ul><li><code>$HADOOP_HOME/bin/hdfs namenode -format -clusterId &lt;cluster_id&gt;</code></li></ul></li><li>升级集群至最新版本。在升级过程中需要提供一个ClusterID，例如：<ul><li><code>$HADOOP_CONF_DIR  -upgrade -clusterId &lt;cluster_ID&gt;</code>如果没有提供ClusterID，则会自动生成一个ClusterID。</li></ul></li></ul></li><li><p>blockpoolID：是针对每一个Namespace所对应的blockpool的ID，上面的这个BP-893790215-192.168.24.72-1383809616115就是在我的ns1的namespace下的存储块池的ID，这个ID包括了其对应的NameNode节点的ip地址。</p></li></ul></li><li><p>\$dfs.namenode.name.dir/current/seen_txid非常重要，是存放transactionId的文件，format之后是0，它代表的是namenode里面的edits_*文件的尾数，namenode重启的时候，会按照seen_txid的数字，循序从头跑edits_0000001~到seen_txid的数字。所以当你的hdfs发生异常重启的时候，一定要比对seen_txid内的数字是不是你edits最后的尾数，不然会发生建置namenode时metaData的资料有缺少，导致误删Datanode上多余Block的资讯。</p></li><li><p>$dfs.namenode.name.dir/current目录下在format的同时也会生成fsimage和edits文件，及其对应的md5校验文件。</p></li><li><p>文件中记录的是edits滚动的序号，每次重启namenode时，namenode就知道要将哪些edits进行加载edits</p></li></ul><h3 id="DATANODE的工作机制"><a href="#DATANODE的工作机制" class="headerlink" title="DATANODE的工作机制"></a>DATANODE的工作机制</h3><p>问题场景：</p><ol><li>集群容量不够，怎么扩容？</li><li>如果有一些datanode宕机，该怎么办？</li><li>datanode明明已启动，但是集群中的可用datanode列表中就是没有，怎么办？</li></ol><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><h5 id="Datanode工作职责"><a href="#Datanode工作职责" class="headerlink" title="Datanode工作职责"></a>Datanode工作职责</h5><ul><li><p>存储管理用户的文件块数据</p></li><li><p>定期向namenode汇报自身所持有的block信息（通过心跳信息上报）</p><ul><li><p>（这点很重要，因为，当集群中发生某些block副本失效时，集群如何恢复block初始副本数量的问题）</p></li><li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.blockreport.intervalMsec<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>3600000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Determines block reporting interval in milliseconds.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><p>#####Datanode掉线判断时限参数</p><p>datanode进程死亡或者网络故障造成datanode无法与namenode通信，namenode不会立即把该节点判定为死亡，要经过一段时间，这段时间暂称作超时时长。HDFS默认的超时时长为10分钟+30秒。如果定义超时时间为timeout，则超时时长的计算公式为：</p><pre><code>timeout  = 2 * heartbeat.recheck.interval + 10 * dfs.heartbeat.interval。而默认的heartbeat.recheck.interval 大小为5分钟，dfs.heartbeat.interval默认为3秒。需要注意的是hdfs-site.xml 配置文件中的heartbeat.recheck.interval的单位为毫秒，dfs.heartbeat.interval的单位为秒。所以，举个例子，如果heartbeat.recheck.interval设置为5000（毫秒），dfs.heartbeat.interval设置为3（秒，默认），则总的超时时间为40秒。</code></pre><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>heartbeat.recheck.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.heartbeat.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>#####观察验证DATANODE功能</p><ul><li>上传一个文件，观察文件的block具体的物理存放情况：</li><li>在每一台datanode机器上的这个目录中能找到文件的切块：<ul><li><code>/home/hadoop/app/hadoop-2.4.1/tmp/dfs/data/current/BP-193442119-192.168.2.120-1432457733977/current/finalized</code></li></ul></li></ul><h2 id="HDFS应用开发篇"><a href="#HDFS应用开发篇" class="headerlink" title="HDFS应用开发篇"></a>HDFS应用开发篇</h2><h3 id="HDFS的java操作"><a href="#HDFS的java操作" class="headerlink" title="HDFS的java操作"></a>HDFS的java操作</h3><p>hdfs在生产应用中主要是客户端的开发，其核心步骤是从hdfs提供的api中构造一个HDFS的访问客户端对象，然后通过该客户端对象操作（增删改查）HDFS上的文件</p><h3 id="搭建开发环境"><a href="#搭建开发环境" class="headerlink" title="搭建开发环境"></a>搭建开发环境</h3><ol><li>引入依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注：如需手动引入jar包，hdfs的jar包—-hadoop的安装目录的share下</p><ol><li>window下开发的说明<ol><li>建议在linux下进行hadoop应用的开发，不会存在兼容性问题。如在window上做客户端应用开发，需要设置以下环境：<br>A. 在windows的某个目录下解压一个hadoop的安装包<br>B. 将安装包下的lib和bin目录用对应windows版本平台编译的本地库替换<br>C. 在window系统中配置HADOOP_HOME指向你解压的安装包<br>D. 在windows系统的path变量中加入hadoop的bin目录</li></ol></li></ol><h3 id="获取api中的客户端对象"><a href="#获取api中的客户端对象" class="headerlink" title="获取api中的客户端对象"></a>获取api中的客户端对象</h3><ul><li>在java中操作hdfs，首先要获得一个客户端实例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Configuration conf = <span class="keyword">new</span> Configuration()</span><br><span class="line">FileSystem fs = FileSystem.get(conf)</span><br></pre></td></tr></table></figure><ul><li>而我们的操作目标是HDFS，所以获取到的fs对象应该是DistributedFileSystem的实例；</li><li>get方法是从何处判断具体实例化那种客户端类呢？<ul><li>从conf中的一个参数 fs.defaultFS的配置值判断；</li></ul></li><li>如果我们的代码中没有指定fs.defaultFS，并且工程classpath下也没有给定相应的配置，conf中的默认值就来自于hadoop的jar包中的core-default.xml，默认值为： file:///，则获取的将不是一个DistributedFileSystem的实例，而是一个本地文件系统的客户端对象</li></ul><h3 id="DistributedFileSystem实例对象所具备的方法"><a href="#DistributedFileSystem实例对象所具备的方法" class="headerlink" title="DistributedFileSystem实例对象所具备的方法"></a>DistributedFileSystem实例对象所具备的方法</h3><p><img src="http://ou9crezlk.bkt.clouddn.com/blog/171023/B09g2g05Fi.png?imageslim" alt="mark"></p><h3 id="HDFS客户端操作数据代码示例"><a href="#HDFS客户端操作数据代码示例" class="headerlink" title="HDFS客户端操作数据代码示例"></a>HDFS客户端操作数据代码示例</h3><h4 id="文件的增删改查"><a href="#文件的增删改查" class="headerlink" title="文件的增删改查"></a>文件的增删改查</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.BlockLocation;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileStatus;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.LocatedFileStatus;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.RemoteIterator;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 客户端去操作hdfs时，是有一个用户身份的</span></span><br><span class="line"><span class="comment"> * 默认情况下，hdfs客户端api会从jvm中获取一个参数来作为自己的用户身份：-DHADOOP_USER_NAME=hadoop</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 也可以在构造客户端fs对象时，通过参数传递进去</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HdfsClientDemo</span> </span>&#123;</span><br><span class="line">FileSystem fs = <span class="keyword">null</span>;</span><br><span class="line">Configuration conf = <span class="keyword">null</span>;</span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">conf = <span class="keyword">new</span> Configuration();</span><br><span class="line"><span class="comment">//conf.set("fs.defaultFS", "hdfs://mini1:9000");</span></span><br><span class="line">conf.set(<span class="string">"dfs.replication"</span>, <span class="string">"5"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//拿到一个文件系统操作的客户端实例对象</span></span><br><span class="line">fs = FileSystem.get(conf);</span><br><span class="line"><span class="comment">//可以直接传入 uri和用户身份</span></span><br><span class="line">fs = FileSystem.get(<span class="keyword">new</span> URI(<span class="string">"hdfs://mini1:9000"</span>),conf,<span class="string">"hadoop"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传文件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">fs.copyFromLocalFile(<span class="keyword">new</span> Path(<span class="string">"c:/access.log"</span>), <span class="keyword">new</span> Path(<span class="string">"/access.log.copy"</span>));</span><br><span class="line">fs.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下载文件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDownload</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">fs.copyToLocalFile(<span class="keyword">new</span> Path(<span class="string">"/access.log.copy"</span>), <span class="keyword">new</span> Path(<span class="string">"d:/"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConf</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">Iterator&lt;Entry&lt;String, String&gt;&gt; it = conf.iterator();</span><br><span class="line"><span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">Entry&lt;String, String&gt; ent = it.next();</span><br><span class="line">System.out.println(ent.getKey() + <span class="string">" : "</span> + ent.getValue());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMkdir</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">boolean</span> mkdirs = fs.mkdirs(<span class="keyword">new</span> Path(<span class="string">"/testmkdir/aaa/bbb"</span>));</span><br><span class="line">System.out.println(mkdirs);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> flag = fs.delete(<span class="keyword">new</span> Path(<span class="string">"/testmkdir/aaa"</span>), <span class="keyword">true</span>);</span><br><span class="line">System.out.println(flag);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递归列出指定目录下所有子文件夹中的文件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLs</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">RemoteIterator&lt;LocatedFileStatus&gt; listFiles = fs.listFiles(<span class="keyword">new</span> Path(<span class="string">"/"</span>), <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(listFiles.hasNext())&#123;</span><br><span class="line">LocatedFileStatus fileStatus = listFiles.next();</span><br><span class="line">System.out.println(<span class="string">"blocksize: "</span> +fileStatus.getBlockSize());</span><br><span class="line">System.out.println(<span class="string">"owner: "</span> +fileStatus.getOwner());</span><br><span class="line">System.out.println(<span class="string">"Replication: "</span> +fileStatus.getReplication());</span><br><span class="line">System.out.println(<span class="string">"Permission: "</span> +fileStatus.getPermission());</span><br><span class="line">System.out.println(<span class="string">"Name: "</span> +fileStatus.getPath().getName());</span><br><span class="line">System.out.println(<span class="string">"------------------"</span>);</span><br><span class="line">BlockLocation[] blockLocations = fileStatus.getBlockLocations();</span><br><span class="line"><span class="keyword">for</span>(BlockLocation b:blockLocations)&#123;</span><br><span class="line">System.out.println(<span class="string">"块起始偏移量: "</span> +b.getOffset());</span><br><span class="line">System.out.println(<span class="string">"块长度:"</span> + b.getLength());</span><br><span class="line"><span class="comment">//块所在的datanode节点</span></span><br><span class="line">String[] datanodes = b.getHosts();</span><br><span class="line"><span class="keyword">for</span>(String dn:datanodes)&#123;</span><br><span class="line">System.out.println(<span class="string">"datanode:"</span> + dn);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLs2</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">FileStatus[] listStatus = fs.listStatus(<span class="keyword">new</span> Path(<span class="string">"/"</span>));</span><br><span class="line"><span class="keyword">for</span>(FileStatus file :listStatus)&#123;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"name: "</span> + file.getPath().getName());</span><br><span class="line">System.out.println((file.isFile()?<span class="string">"file"</span>:<span class="string">"directory"</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">conf.set(<span class="string">"fs.defaultFS"</span>, <span class="string">"hdfs://mini1:9000"</span>);</span><br><span class="line"><span class="comment">//拿到一个文件系统操作的客户端实例对象</span></span><br><span class="line">FileSystem fs = FileSystem.get(conf);</span><br><span class="line"></span><br><span class="line">fs.copyFromLocalFile(<span class="keyword">new</span> Path(<span class="string">"c:/access.log"</span>), <span class="keyword">new</span> Path(<span class="string">"/access.log.copy"</span>));</span><br><span class="line">fs.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="通过流的方式访问hdfs"><a href="#通过流的方式访问hdfs" class="headerlink" title="通过流的方式访问hdfs"></a>通过流的方式访问hdfs</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 相对那些封装好的方法而言的更底层一些的操作方式</span></span><br><span class="line"><span class="comment"> * 上层那些mapreduce   spark等运算框架，去hdfs中获取数据的时候，就是调的这种底层的api</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamAccess</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">FileSystem fs = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">fs = FileSystem.get(<span class="keyword">new</span> URI(<span class="string">"hdfs://hdp-node01:9000"</span>), conf, <span class="string">"hadoop"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过流的方式上传文件到hdfs</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">FSDataOutputStream outputStream = fs.create(<span class="keyword">new</span> Path(<span class="string">"/angelababy.love"</span>), <span class="keyword">true</span>);</span><br><span class="line">FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">"c:/angelababy.love"</span>);</span><br><span class="line"></span><br><span class="line">IOUtils.copy(inputStream, outputStream);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDownLoadFileToLocal</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException, IOException</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//先获取一个文件的输入流----针对hdfs上的</span></span><br><span class="line">FSDataInputStream in = fs.open(<span class="keyword">new</span> Path(<span class="string">"/jdk-7u65-linux-i586.tar.gz"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//再构造一个文件的输出流----针对本地的</span></span><br><span class="line">FileOutputStream out = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">"c:/jdk.tar.gz"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//再将输入流中数据传输到输出流</span></span><br><span class="line">IOUtils.copyBytes(in, out, <span class="number">4096</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * hdfs支持随机定位进行文件读取，而且可以方便地读取指定长度</span></span><br><span class="line"><span class="comment"> * 用于上层分布式运算框架并发处理数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRandomAccess</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException, IOException</span>&#123;</span><br><span class="line"><span class="comment">//先获取一个文件的输入流----针对hdfs上的</span></span><br><span class="line">FSDataInputStream in = fs.open(<span class="keyword">new</span> Path(<span class="string">"/iloveyou.txt"</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//可以将流的起始偏移量进行自定义</span></span><br><span class="line">in.seek(<span class="number">22</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//再构造一个文件的输出流----针对本地的</span></span><br><span class="line">FileOutputStream out = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">"c:/iloveyou.line.2.txt"</span>));</span><br><span class="line"></span><br><span class="line">IOUtils.copyBytes(in,out,<span class="number">19L</span>,<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示hdfs上文件的内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCat</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException, IOException</span>&#123;</span><br><span class="line"></span><br><span class="line">FSDataInputStream in = fs.open(<span class="keyword">new</span> Path(<span class="string">"/iloveyou.txt"</span>));</span><br><span class="line"></span><br><span class="line">IOUtils.copyBytes(in, System.out, <span class="number">1024</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="场景编程"><a href="#场景编程" class="headerlink" title="场景编程"></a>场景编程</h4><p>在mapreduce 、spark等运算框架中，有一个核心思想就是将运算移往数据，或者说，就是要在并发计算中尽可能让运算本地化，这就需要获取数据所在位置的信息并进行相应范围读取以下模拟实现：获取一个文件的所有block位置信息，然后读取指定block中的内容</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCat</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException, IOException</span>&#123;</span><br><span class="line"></span><br><span class="line">FSDataInputStream in = fs.open(<span class="keyword">new</span> Path(<span class="string">"/wordcount/data"</span>));</span><br><span class="line"><span class="comment">//拿到文件信息</span></span><br><span class="line">FileStatus[] listStatus = fs.listStatus(<span class="keyword">new</span> Path(<span class="string">"/wordcount/data"</span>));</span><br><span class="line"><span class="comment">//获取这个文件的所有block的信息</span></span><br><span class="line">BlockLocation[] fileBlockLocations = fs.getFileBlockLocations(listStatus[<span class="number">0</span>], <span class="number">0L</span>, listStatus[<span class="number">0</span>].getLen());</span><br><span class="line"><span class="comment">//第一个block的长度</span></span><br><span class="line"><span class="keyword">long</span> length = fileBlockLocations[<span class="number">0</span>].getLength();</span><br><span class="line"><span class="comment">//第一个block的起始偏移量</span></span><br><span class="line"><span class="keyword">long</span> offset = fileBlockLocations[<span class="number">0</span>].getOffset();</span><br><span class="line"></span><br><span class="line">System.out.println(length);</span><br><span class="line">System.out.println(offset);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取第一个block写入输出流</span></span><br><span class="line"><span class="comment">//IOUtils.copyBytes(in, System.out, (int)length);</span></span><br><span class="line"><span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4096</span>];</span><br><span class="line"></span><br><span class="line">FileOutputStream os = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">"d:/block0"</span>));</span><br><span class="line"><span class="keyword">while</span>(in.read(offset, b, <span class="number">0</span>, <span class="number">4096</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">os.write(b);</span><br><span class="line">offset += <span class="number">4096</span>;</span><br><span class="line"><span class="keyword">if</span>(offset&gt;=length) <span class="keyword">return</span>;</span><br><span class="line">&#125;;</span><br><span class="line">os.flush();</span><br><span class="line">os.close();</span><br><span class="line">in.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;HDFS前言&quot;&gt;&lt;a href=&quot;#HDFS前言&quot; class=&quot;headerlink&quot; title=&quot;HDFS前言&quot;&gt;&lt;/a&gt;HDFS前言&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;设计思想&lt;ul&gt;
&lt;li&gt;分而治之：将大文件、大批量文件，分布式存放在大量服务器上，&lt;stron
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Hadoop" scheme="http://yoursite.com/tags/Hadoop/"/>
    
      <category term="HDFS" scheme="http://yoursite.com/tags/HDFS/"/>
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Hadoop学习遇到问题</title>
    <link href="http://yoursite.com/2018/03/06/Hadoop%E5%AD%A6%E4%B9%A0%E9%81%87%E5%88%B0%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2018/03/06/Hadoop学习遇到问题/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T07:45:27.323Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hadoop集群警告"><a href="#Hadoop集群警告" class="headerlink" title="Hadoop集群警告"></a>Hadoop集群警告</h1><p>##查看集群状态</p><ul><li>hdfs dfsadmin -report</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">Configured Capacity: 55306051584 (51.51 GB)</span><br><span class="line">Present Capacity: 46777233408 (43.56 GB)</span><br><span class="line">DFS Remaining: 46777159680 (43.56 GB)</span><br><span class="line">DFS Used: 73728 (72 KB)</span><br><span class="line">DFS Used%: 0.00%</span><br><span class="line">Under replicated blocks: 0</span><br><span class="line">Blocks with corrupt replicas: 0</span><br><span class="line">Missing blocks: 0</span><br><span class="line"></span><br><span class="line">-------------------------------------------------</span><br><span class="line">Live datanodes (3):</span><br><span class="line"></span><br><span class="line">Name: 192.168.127.63:50010 (mini3)</span><br><span class="line">Hostname: mini3</span><br><span class="line">Decommission Status : Normal</span><br><span class="line">Configured Capacity: 18435350528 (17.17 GB)</span><br><span class="line">DFS Used: 24576 (24 KB)</span><br><span class="line">Non DFS Used: 2847330304 (2.65 GB)</span><br><span class="line">DFS Remaining: 15587995648 (14.52 GB)</span><br><span class="line">DFS Used%: 0.00%</span><br><span class="line">DFS Remaining%: 84.55%</span><br><span class="line">Configured Cache Capacity: 0 (0 B)</span><br><span class="line">Cache Used: 0 (0 B)</span><br><span class="line">Cache Remaining: 0 (0 B)</span><br><span class="line">Cache Used%: 100.00%</span><br><span class="line">Cache Remaining%: 0.00%</span><br><span class="line">Xceivers: 1</span><br><span class="line">Last contact: Tue Oct 24 00:10:37 CST 2017</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Name: 192.168.127.62:50010 (mini2)</span><br><span class="line">Hostname: mini2</span><br><span class="line">Decommission Status : Normal</span><br><span class="line">Configured Capacity: 18435350528 (17.17 GB)</span><br><span class="line">DFS Used: 24576 (24 KB)</span><br><span class="line">Non DFS Used: 2847182848 (2.65 GB)</span><br><span class="line">DFS Remaining: 15588143104 (14.52 GB)</span><br><span class="line">DFS Used%: 0.00%</span><br><span class="line">DFS Remaining%: 84.56%</span><br><span class="line">Configured Cache Capacity: 0 (0 B)</span><br><span class="line">Cache Used: 0 (0 B)</span><br><span class="line">Cache Remaining: 0 (0 B)</span><br><span class="line">Cache Used%: 100.00%</span><br><span class="line">Cache Remaining%: 0.00%</span><br><span class="line">Xceivers: 1</span><br><span class="line">Last contact: Tue Oct 24 00:10:37 CST 2017</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Name: 192.168.127.64:50010 (mini4)</span><br><span class="line">Hostname: mini4</span><br><span class="line">Decommission Status : Normal</span><br><span class="line">Configured Capacity: 18435350528 (17.17 GB)</span><br><span class="line">DFS Used: 24576 (24 KB)</span><br><span class="line">Non DFS Used: 2834305024 (2.64 GB)</span><br><span class="line">DFS Remaining: 15601020928 (14.53 GB)</span><br><span class="line">DFS Used%: 0.00%</span><br><span class="line">DFS Remaining%: 84.63%</span><br><span class="line">Configured Cache Capacity: 0 (0 B)</span><br><span class="line">Cache Used: 0 (0 B)</span><br><span class="line">Cache Remaining: 0 (0 B)</span><br><span class="line">Cache Used%: 100.00%</span><br><span class="line">Cache Remaining%: 0.00%</span><br><span class="line">Xceivers: 1</span><br><span class="line">Last contact: Tue Oct 24 00:10:37 CST 2017</span><br></pre></td></tr></table></figure><h2 id="警告的解决"><a href="#警告的解决" class="headerlink" title="警告的解决"></a>警告的解决</h2><ul><li><p>警告1</p><ul><li>Java HotSpot(TM) Client VM warning: You have loaded library /home/hujian/apps/hadoop-2.6.4/lib/native/libhadoop.so.1.0.0 which might have disabled stack guard. The VM will try to fix the stack guard now.</li><li>It’s highly recommended that you fix the library with ‘execstack -c <libfile>‘, or link it with ‘-z noexecstack’.</libfile></li></ul></li><li><p>解决方案：</p></li><li><p>在/etc/profile下添加如下两条环境变量</p><ul><li>export HADOOP_COMMON_LIB_NATIVE_DIR=${HADOOP_HOME}/lib/native</li><li>export HADOOP_OPTS=”-Djava.library.path=$HADOOP_HOME/lib”</li></ul></li><li><p>然后：</p><ul><li>source /etc/profile</li></ul></li><li><p>再启动hadoop</p></li><li><p>警告2：</p><ul><li>WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform… using builtin-java classes where applicable</li></ul></li><li><p>解决方案：</p><ul><li><p>直接在log4j日志中去除告警信息。在hadoop的安装目录 /apps/hadoop-2.5.2/etc/hadoop/log4j.properties文件中添加</p></li><li><blockquote><p>log4j.logger.org.apache.hadoop.util.NativeCodeLoader=ERROR</p></blockquote></li></ul></li></ul><h2 id="操作HDFS报错"><a href="#操作HDFS报错" class="headerlink" title="操作HDFS报错"></a>操作HDFS报错</h2><p>15/10/08 21:04:19 INFO hdfs.DFSClient: Exception in createBlockOutputStream<br>java.io.IOException: Got error, status message , ack with firstBadLink as 192.168.1.114:50010<br> at org.apache.hadoop.hdfs.protocol.datatransfer.DataTransferProtoUtil.checkBlockOpStatus(DataTransferProtoUtil.java:140)<br> at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.createBlockOutputStream(DFSOutputStream.java:1334)<br> at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.nextBlockOutputStream(DFSOutputStream.java:1237)</p><p>原因是由于centos7的防火墙引起与datanode无法通讯造成。</p><p>centos7 关闭防火墙 service firewalld stop</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Hadoop集群警告&quot;&gt;&lt;a href=&quot;#Hadoop集群警告&quot; class=&quot;headerlink&quot; title=&quot;Hadoop集群警告&quot;&gt;&lt;/a&gt;Hadoop集群警告&lt;/h1&gt;&lt;p&gt;##查看集群状态&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;hdfs dfsadmin -r
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Hadoop" scheme="http://yoursite.com/tags/Hadoop/"/>
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Hive安装配置</title>
    <link href="http://yoursite.com/2018/03/06/Hive%E5%AE%89%E8%A3%85/"/>
    <id>http://yoursite.com/2018/03/06/Hive安装/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:49:54.197Z</updated>
    
    <content type="html"><![CDATA[<p>Hive是基于Hadoop构建的一套数据仓库分析系统，它提供了丰富的SQL查询方式来分析存储在Hadoop 分布式文件系统中的数据。其在Hadoop的架构体系中承担了一个SQL解析的过程，它提供了对外的入口来获取用户的指令然后对指令进行分析，解析出一个MapReduce程序组成可执行计划，并按照该计划生成对应的MapReduce任务提交给Hadoop集群处理，获取最终的结果。元数据——如表模式——存储在名为metastore的数据库中。</p><h3 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.186.128 hadoop-master</span><br><span class="line">192.168.186.129 hadoop-slave</span><br><span class="line">MySQL安装在master机器上，hive服务器也安装在master上</span><br></pre></td></tr></table></figure><h3 id="Hive下载"><a href="#Hive下载" class="headerlink" title="Hive下载"></a>Hive下载</h3><p>下载源码包，最新版本可自行去官网下载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop-master ~]$ wget http://mirrors.cnnic.cn/apache/hive/hive-1.2.1/apache-hive-1.2.1-bin.tar.gz</span><br><span class="line">[hadoop@hadoop-master ~]$ tar -zxf apache-hive-1.2.1-bin.tar.gz </span><br><span class="line">[hadoop@hadoop-master ~]$ ls</span><br><span class="line">apache-hive-1.2.1-bin  apache-hive-1.2.1-bin.tar.gz  dfs  hadoop-2.7.1  Hsource  tmp</span><br></pre></td></tr></table></figure><p>配置环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop-master hadoop]# vi /etc/profile</span><br><span class="line">HIVE_HOME=/home/hadoop/apache-hive-1.2.1-bin</span><br><span class="line">PATH=$PATH:$HIVE_HOME/bin</span><br><span class="line">export HIVE_NAME PATH</span><br><span class="line">[root@hadoop-master hadoop]# source /etc/profile</span><br></pre></td></tr></table></figure><h3 id="Metastore"><a href="#Metastore" class="headerlink" title="Metastore"></a>Metastore</h3><p>metastore是Hive元数据集中存放地。它包括两部分：服务和后台数据存储。有三种方式配置metastore：内嵌metastore、本地metastore以及远程metastore。<br>本次搭建中采用MySQL作为远程仓库，部署在hadoop-master节点上，hive服务端也安装在hive-master上，hive客户端即hadoop-slave访问hive服务器。</p><h4 id="MySQL安装"><a href="#MySQL安装" class="headerlink" title="MySQL安装"></a>MySQL安装</h4><h5 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install gcc gcc-c++ ncurses-devel  -y</span><br></pre></td></tr></table></figure><h5 id="安装cmake"><a href="#安装cmake" class="headerlink" title="安装cmake"></a>安装cmake</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># wget http://www.cmake.org/files/v2.8/cmake-2.8.12.tar.gz</span><br><span class="line"># tar zxvf cmake-2.8.12.tar.gz</span><br><span class="line"># cd cmake-2.8.12</span><br><span class="line"># ./bootstrap </span><br><span class="line"># make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h5 id="创建用户的相应目录"><a href="#创建用户的相应目录" class="headerlink" title="创建用户的相应目录"></a>创建用户的相应目录</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># groupadd mysql</span><br><span class="line"># useradd -g mysql mysql</span><br><span class="line"># mkdir -p /data/mysql/</span><br><span class="line"># mkdir -p /data/mysql/data/</span><br><span class="line"># mkdir -p /data/mysql/log/</span><br></pre></td></tr></table></figure><h5 id="获取MySQL安装包并安装"><a href="#获取MySQL安装包并安装" class="headerlink" title="获取MySQL安装包并安装"></a>获取MySQL安装包并安装</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># wget http://dev.mysql.com/get/downloads/mysql/mysql-5.6.25.tar.gz</span><br><span class="line"># tar zxvf mysql-5.6.25.tar.gz</span><br><span class="line"># cd mysql-5.6.25</span><br><span class="line"># cmake \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=/data/mysql \</span><br><span class="line">-DMYSQL_UNIX_ADDR=/data/mysql/mysql.sock \</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_ARCHIVE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DMYSQL_DATADIR=/data/mysql/data \</span><br><span class="line">-DMYSQL_TCP_PORT=3306 \</span><br><span class="line">-DENABLE_DOWNLOADS=1</span><br><span class="line">如果报错找不到CMakeCache.txt则说明没安装ncurses-devel</span><br><span class="line"> </span><br><span class="line"># make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h5 id="修改目录权限"><a href="#修改目录权限" class="headerlink" title="修改目录权限"></a>修改目录权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># chmod +w /data/mysql/</span><br><span class="line"># chown -R mysql:mysql /data/mysql/</span><br><span class="line"># ln -s /data/mysql/lib/libmysqlclient.so.18 /usr/lib/libmysqlclient.so.18</span><br><span class="line"># ln -s /data/mysql/mysql.sock /tmp/mysql.sock</span><br></pre></td></tr></table></figure><h5 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># cp /data/mysql/support-files/my-default.cnf /etc/my.cnf</span><br><span class="line"># cp /data/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line"># /data/mysql/scripts/mysql_install_db --user=mysql --defaults-file=/etc/my.cnf --basedir=/data/mysql --datadir=/data/mysql/data</span><br></pre></td></tr></table></figure><h5 id="启动MySQL服务"><a href="#启动MySQL服务" class="headerlink" title="启动MySQL服务"></a>启动MySQL服务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># chmod +x /etc/init.d/mysqld</span><br><span class="line"># service mysqld start</span><br><span class="line">#ln –s /data/mysql/bin/mysql /usr/bin/</span><br></pre></td></tr></table></figure><h5 id="初始化密码"><a href="#初始化密码" class="headerlink" title="初始化密码"></a>初始化密码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#mysql -uroot  -h127.0.0.1 -p</span><br><span class="line">mysql&gt; SET PASSWORD = PASSWORD(&apos;123456&apos;);</span><br></pre></td></tr></table></figure><h4 id="创建Hive用户"><a href="#创建Hive用户" class="headerlink" title="创建Hive用户"></a>创建Hive用户</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;CREATE USER &apos;hive&apos; IDENTIFIED BY &apos;hive&apos;;</span><br><span class="line">mysql&gt;GRANT ALL PRIVILEGES ON *.* TO &apos;hive&apos;@&apos;hadoop-master&apos; WITH GRANT OPTION;</span><br><span class="line">mysql&gt;flush privileges;</span><br></pre></td></tr></table></figure><h4 id="Hive用户登录"><a href="#Hive用户登录" class="headerlink" title="Hive用户登录"></a>Hive用户登录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop-master ~]mysql -h hadoop-master -uhive</span><br><span class="line">mysql&gt;set password = password(&apos;hive&apos;);</span><br></pre></td></tr></table></figure><h4 id="创建Hive数据库"><a href="#创建Hive数据库" class="headerlink" title="创建Hive数据库"></a>创建Hive数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;create database hive;</span><br></pre></td></tr></table></figure><h3 id="配置Hive"><a href="#配置Hive" class="headerlink" title="配置Hive"></a>配置Hive</h3><h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>进入到hive的配置文件目录下，找到hive-default.xml.template，cp份为hive-default.xml<br>另创建hive-site.xml并添加参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop-master conf]$ pwd</span><br><span class="line">/home/hadoop/apache-hive-1.2.1-bin/conf</span><br><span class="line">[hadoop@hadoop-master conf]$ vi hive-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;jdbc:mysql://hadoop-master:3306/hive?createDatabaseIfNotExist=true&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;JDBC connect string for a JDBC metastore&lt;/description&gt;    </span><br><span class="line">&lt;/property&gt;   </span><br><span class="line">&lt;property&gt; </span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt; </span><br><span class="line">        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt; </span><br><span class="line">        &lt;description&gt;Driver class name for a JDBC metastore&lt;/description&gt;     </span><br><span class="line">&lt;/property&gt;               </span><br><span class="line"> </span><br><span class="line">&lt;property&gt; </span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hive&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;username to use against metastore database&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;  </span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hive&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;password to use against metastore database&lt;/description&gt;  </span><br><span class="line">&lt;/property&gt;          </span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><h4 id="JDBC下载"><a href="#JDBC下载" class="headerlink" title="JDBC下载"></a>JDBC下载</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop-master ~]$ wget http://cdn.mysql.com/Downloads/Connector-J/mysql-connector-java-5.1.36.tar.gz</span><br><span class="line">[hadoop@hadoop-master ~]$ ls</span><br><span class="line">apache-hive-1.2.1-bin  dfs  hadoop-2.7.1  Hsource  tmp</span><br><span class="line">[hadoop@hadoop-master ~]$ cp mysql-connector-java-5.1.33-bin.jar apache-hive-1.2.1-bin/lib/</span><br></pre></td></tr></table></figure><h4 id="Hive客户端配置"><a href="#Hive客户端配置" class="headerlink" title="Hive客户端配置"></a>Hive客户端配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop-master ~]$ scp -r apache-hive-1.2.1-bin/ hadoop@hadoop-slave:/home/hadoop</span><br><span class="line">[hadoop@hadoop-slave conf]$ vi hive-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;  </span><br><span class="line">&lt;name&gt;hive.metastore.uris&lt;/name&gt;  </span><br><span class="line">&lt;value&gt;thrift://hadoop-master:9083&lt;/value&gt;  </span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><h4 id="Hive启动"><a href="#Hive启动" class="headerlink" title="Hive启动"></a>Hive启动</h4><p>要启动metastore服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop-master ~]$ hive --service metastore &amp;</span><br><span class="line">[hadoop@hadoop-master ~]$ jps</span><br><span class="line">10288 RunJar  #多了一个进程</span><br><span class="line">9365 NameNode</span><br><span class="line">9670 SecondaryNameNode</span><br><span class="line">11096 Jps</span><br><span class="line">9944 NodeManager</span><br><span class="line">9838 ResourceManager</span><br><span class="line">9471 DataNode</span><br></pre></td></tr></table></figure><h4 id="Hive服务器端访问"><a href="#Hive服务器端访问" class="headerlink" title="Hive服务器端访问"></a>Hive服务器端访问</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop-master ~]$ hive</span><br><span class="line">Logging initialized using configuration in jar:file:/home/hadoop/apache-hive-1.2.1-bin/lib/hive-common-1.2.1.jar!/hive-log4j.properties</span><br><span class="line">hive&gt; show databases;</span><br><span class="line">OK</span><br><span class="line">default</span><br><span class="line">src</span><br><span class="line">Time taken: 1.332 seconds, Fetched: 2 row(s)</span><br><span class="line">hive&gt; use src;</span><br><span class="line">OK</span><br><span class="line">Time taken: 0.037 seconds</span><br><span class="line">hive&gt; create table test1(id int);</span><br><span class="line">OK</span><br><span class="line">Time taken: 0.572 seconds</span><br><span class="line">hive&gt; show tables;</span><br><span class="line">OK</span><br><span class="line">abc</span><br><span class="line">test</span><br><span class="line">test1</span><br><span class="line">Time taken: 0.057 seconds, Fetched: 3 row(s)</span><br><span class="line">hive&gt;</span><br></pre></td></tr></table></figure><h4 id="Hive客户端访问"><a href="#Hive客户端访问" class="headerlink" title="Hive客户端访问"></a>Hive客户端访问</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop-slave conf]$ hive</span><br><span class="line">Logging initialized using configuration in jar:file:/home/hadoop/apache-hive-1.2.1-bin/lib/hive-common-1.2.1.jar!/hive-log4j.properties</span><br><span class="line">hive&gt; show databases;</span><br><span class="line">OK</span><br><span class="line">default</span><br><span class="line">src</span><br><span class="line">Time taken: 1.022 seconds, Fetched: 2 row(s)</span><br><span class="line">hive&gt; use src;</span><br><span class="line">OK</span><br><span class="line">Time taken: 0.057 seconds</span><br><span class="line">hive&gt; show tables;</span><br><span class="line">OK</span><br><span class="line">abc</span><br><span class="line">test</span><br><span class="line">test1</span><br><span class="line">Time taken: 0.218 seconds, Fetched: 3 row(s)</span><br><span class="line">hive&gt; create table test2(id int ,name string);</span><br><span class="line">OK</span><br><span class="line">Time taken: 5.518 seconds</span><br><span class="line">hive&gt; show tables;</span><br><span class="line">OK</span><br><span class="line">abc</span><br><span class="line">test</span><br><span class="line">test1</span><br><span class="line">test2</span><br><span class="line">Time taken: 0.102 seconds, Fetched: 4 row(s)</span><br><span class="line">hive&gt;</span><br></pre></td></tr></table></figure><p>好了，测试完毕，已经安装成功了。</p><h3 id="安装问题纠错"><a href="#安装问题纠错" class="headerlink" title="安装问题纠错"></a>安装问题纠错</h3><h4 id="Hive数据库编码问题"><a href="#Hive数据库编码问题" class="headerlink" title="Hive数据库编码问题"></a>Hive数据库编码问题</h4><p>错误描述：hive进入后可以创建数据库，但是无法创建表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;create table table_test(id string,name string);</span><br><span class="line">FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask.MetaException(message:javax.jdo.JDODataStoreException: An exception was thrown while adding/validating class(es) : Specified key was too long; max key length is 767 bytes</span><br></pre></td></tr></table></figure><p>解决办法：登录mysql修改下hive数据库的编码方式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;alter database hive character set latin1;</span><br></pre></td></tr></table></figure><h4 id="防火墙问题"><a href="#防火墙问题" class="headerlink" title="防火墙问题"></a>防火墙问题</h4><p>Hive服务器开启了iptables服务，hive本机可以访问hive服务，hive的客户端hadoop-slave访问报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop-slave conf]$ hive</span><br><span class="line">Logging initialized using configuration in jar:file:/home/hadoop/apache-hive-1.2.1-bin/lib/hive-common-1.2.1.jar!/hive-log4j.properties</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.RuntimeException: java.lang.RuntimeException: Unable to instantiate org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient</span><br><span class="line">        at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:522)</span><br><span class="line">        at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:677)</span><br><span class="line">        at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:621)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:483)</span><br><span class="line">        at org.apache.hadoop.util.RunJar.run(RunJar.java:221)</span><br><span class="line">        at org.apache.hadoop.util.RunJar.main(RunJar.java:136)</span><br><span class="line">Caused by: java.lang.RuntimeException: Unable to instantiate org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient</span><br><span class="line">        at org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1523)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.&lt;init&gt;(RetryingMetaStoreClient.java:86)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:132)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:104)</span><br><span class="line">        at org.apache.hadoop.hive.ql.metadata.Hive.createMetaStoreClient(Hive.java:3005)</span><br><span class="line">        at org.apache.hadoop.hive.ql.metadata.Hive.getMSC(Hive.java:3024)</span><br><span class="line">        at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:503)</span><br><span class="line">        ... 8 more</span><br><span class="line">Caused by: java.lang.reflect.InvocationTargetException</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">        at java.lang.reflect.Constructor.newInstance(Constructor.java:408)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1521)</span><br><span class="line">        ... 14 more</span><br><span class="line">Caused by: MetaException(message:Could not connect to meta store using any of the URIs provided. Most recent failure: org.apache.thrift.transport.TTransportException: java.net.NoRouteToHostException: No route to host</span><br><span class="line">        at org.apache.thrift.transport.TSocket.open(TSocket.java:187)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.open(HiveMetaStoreClient.java:420)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.&lt;init&gt;(HiveMetaStoreClient.java:236)</span><br><span class="line">        at org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient.&lt;init&gt;(SessionHiveMetaStoreClient.java:74)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">        at java.lang.reflect.Constructor.newInstance(Constructor.java:408)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1521)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.&lt;init&gt;(RetryingMetaStoreClient.java:86)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:132)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:104)</span><br><span class="line">        at org.apache.hadoop.hive.ql.metadata.Hive.createMetaStoreClient(Hive.java:3005)</span><br><span class="line">        at org.apache.hadoop.hive.ql.metadata.Hive.getMSC(Hive.java:3024)</span><br><span class="line">        at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:503)</span><br><span class="line">        at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:677)</span><br><span class="line">        at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:621)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:483)</span><br><span class="line">        at org.apache.hadoop.util.RunJar.run(RunJar.java:221)</span><br><span class="line">        at org.apache.hadoop.util.RunJar.main(RunJar.java:136)</span><br><span class="line">Caused by: java.net.NoRouteToHostException: No route to host</span><br><span class="line">        at java.net.PlainSocketImpl.socketConnect(Native Method)</span><br><span class="line">        at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:345)</span><br><span class="line">        at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)</span><br><span class="line">        at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)</span><br><span class="line">        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</span><br><span class="line">        at java.net.Socket.connect(Socket.java:589)</span><br><span class="line">        at org.apache.thrift.transport.TSocket.open(TSocket.java:182)</span><br><span class="line">        ... 22 more</span><br><span class="line">)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.open(HiveMetaStoreClient.java:466)</span><br><span class="line">        at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.&lt;init&gt;(HiveMetaStoreClient.java:236)</span><br><span class="line">        at org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient.&lt;init&gt;(SessionHiveMetaStoreClient.java:74)</span><br><span class="line">        ... 19 more</span><br></pre></td></tr></table></figure><p>解决办法：比较粗暴直接关掉了防火墙</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop-master hadoop]# service iptables stop</span><br><span class="line">iptables: Flushing firewall rules: [  OK  ]</span><br><span class="line">iptables: Setting chains to policy ACCEPT: filter [  OK  ]</span><br><span class="line">iptables: Unloading modules: [  OK  ]</span><br><span class="line">[root@hadoop-master hadoop]#</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Hive是基于Hadoop构建的一套数据仓库分析系统，它提供了丰富的SQL查询方式来分析存储在Hadoop 分布式文件系统中的数据。其在Hadoop的架构体系中承担了一个SQL解析的过程，它提供了对外的入口来获取用户的指令然后对指令进行分析，解析出一个MapReduce程序
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="Hadoop" scheme="http://yoursite.com/tags/Hadoop/"/>
    
      <category term="Hive" scheme="http://yoursite.com/tags/Hive/"/>
    
  </entry>
  
  <entry>
    <title>Centos升级Python 2.7.12并安装最新pip</title>
    <link href="http://yoursite.com/2018/03/06/Centos%E5%8D%87%E7%BA%A7Python%202.7.12%E5%B9%B6%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0pip/"/>
    <id>http://yoursite.com/2018/03/06/Centos升级Python 2.7.12并安装最新pip/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T07:32:42.870Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Centos升级Python-2-7-12并安装最新pip"><a href="#Centos升级Python-2-7-12并安装最新pip" class="headerlink" title="Centos升级Python 2.7.12并安装最新pip"></a>Centos升级Python 2.7.12并安装最新pip</h3><p>Centos系统一般默认就安装有Python2.6.6版本，不少软件需要2.7以上的，通过包管理工具安装不了最新的版本，通过源码编译可以方便安装指定版本，只需要把下面版本的数字换成你想要的版本号。</p><p>1.安装步骤<br>下载源码</p><p><code>wget http://www.python.org/ftp/python/2.7.12/Python-2.7.12.tgz</code> 在下载目录解压源码</p><p><code>tar -zxvf Python-2.7.12.tgz</code> 进入解压后的文件夹</p><p><code>cd Python-2.7.12</code> 在编译前先在/usr/local建一个文件夹python2.7.12（作为python的安装路径，以免覆盖老的版本，新旧版本可以共存的)</p><p><code>mkdir /usr/local/python2.7.12</code> ，编译前需要安装下面依赖，否则下面安装pip就会出错</p><p><code>yum install openssl openssl-devel zlib-devel gcc -y</code></p><p>安装完依赖后执行下面命令</p><p><code>vim ./Modules/Setup</code></p><p>找到#zlib zlibmodule.c -I$(prefix)/include -L$(exec_prefix)/lib -lz去掉注释并保存(即去掉井号)</p><p>在解压缩后的目录下编译安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/python2.7.12 --with-zlib</span><br><span class="line">make  </span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>此时没有覆盖老版本，再将原来/usr/bin/python链接改为别的名字</p><p><code>mv /usr/bin/python /usr/bin/python2.6.6</code> 再建立新版本python的软链接</p><p><code>ln -s /usr/local/python2.7.12/bin/python2.7 /usr/bin/python</code></p><p>这个时候输入</p><p><code>python</code></p><p>就会显示出python的新版本信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Python 2.7.12 (default, Oct 13 2016, 03:17:14)  </span><br><span class="line">[GCC 4.4.7 20120313 (Red Hat 4.4.7-17)] on linux2</span><br><span class="line">Type “help”, “copyright”, “credits” or “license” for more information.</span><br></pre></td></tr></table></figure><p>2.修改yum配置文件<br>之所以要保留旧版本，因为yum依赖Python2.6，改下yum的配置文件，指定旧的Python版本就可以了。</p><p><code>vim /usr/bin/yum</code>， 将第一行的#!/usr/bin/python修改成#!/usr/bin/python2.6.6</p><p>3.安装最新版本的pip<br><code>wget https://bootstrap.pypa.io/get-pip.py</code></p><p><code>python get-pip.py</code> 找到pip2.7的路径</p><p><code>find / -name &quot;pip*&quot;</code></p><p>上面的命令输出 /root/.cache/pip 这里省略一堆输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/python2.7.12/bin/pip</span><br><span class="line">/usr/local/python2.7.12/bin/pip2</span><br><span class="line">/usr/local/python2.7.12/bin/pip2.7 #就是这个</span><br><span class="line">/usr/bin/pip</span><br><span class="line">/usr/bin/pip2</span><br><span class="line">/usr/bin/pip2.6</span><br></pre></td></tr></table></figure><p>为其创建软链作为系统默认的启动版本（之前有旧版本的话就先删掉rm -rf /usr/bin/pip）</p><p><code>ln -s /usr/local/python2.7.12/bin/pip2.7 /usr/bin/pip</code> 看下pip的版本</p><p><code>pip -V</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip 8.1.2 from /usr/local/python2.7.12/lib/python2.7/site-packages (python 2.7)</span><br></pre></td></tr></table></figure><p>pip安装完毕，现在可以用它下载安装各种包了</p><p>我把上面的所有写成下面简单的脚本，一键就可以升级好。</p><p><code>wget http://7xpt4s.com1.z0.glb.clouddn.com/update-python2.7.12.sh &amp;&amp; bash update-python2.7.12.sh</code></p><p>参考：</p><p><a href="https://ruter.github.io/2015/12/03/Update-python/" target="_blank" rel="noopener">https://ruter.github.io/2015/12/03/Update-python/</a></p><p><a href="https://blog.phpgao.com/pip-easy_install-setuptool.html" target="_blank" rel="noopener">https://blog.phpgao.com/pip-easy_install-setuptool.html</a></p><p>原文地址：<a href="https://blog.fazero.me/2016/10/13/centos-update-python/" target="_blank" rel="noopener">https://blog.fazero.me/2016/10/13/centos-update-python/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Centos升级Python-2-7-12并安装最新pip&quot;&gt;&lt;a href=&quot;#Centos升级Python-2-7-12并安装最新pip&quot; class=&quot;headerlink&quot; title=&quot;Centos升级Python 2.7.12并安装最新pip&quot;&gt;&lt;/a
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>IDEA部署hadoop运行环境</title>
    <link href="http://yoursite.com/2018/03/06/IDEA%E9%83%A8%E7%BD%B2hadoop%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/"/>
    <id>http://yoursite.com/2018/03/06/IDEA部署hadoop运行环境/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:52:49.620Z</updated>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>​       前段时间配置好了基于mac的hadoop完全分布式环境，一直想着怎么样去用编译器写程序然后直接在hadoop环境中运行呢，经过一番摸索，写下此文章分享交流。</p><h1 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h1><blockquote><ul><li>os x EI Capitan 10.11.5</li><li>虚拟机：Parallels Desktop</li><li>ubuntukylin 14.04 64bit * 2</li><li>hadoop 2.6.2</li><li>os x上的jdk版本：1.8.0_73，ubuntu上的jdk版本：1.8.0_91（不同机器上的jdk版本不要求一样）</li><li>IntelliJ IDEA 16.1</li></ul></blockquote><h4 id="如果没有配置好hadoop的环境，请参考本人另一篇博文：http-blog-csdn-net-wk51920-article-details-51686038"><a href="#如果没有配置好hadoop的环境，请参考本人另一篇博文：http-blog-csdn-net-wk51920-article-details-51686038" class="headerlink" title="如果没有配置好hadoop的环境，请参考本人另一篇博文：http://blog.csdn.net/wk51920/article/details/51686038"></a>如果没有配置好hadoop的环境，请参考本人另一篇博文：<a href="http://blog.csdn.net/wk51920/article/details/51686038" target="_blank" rel="noopener">http://blog.csdn.net/wk51920/article/details/51686038</a></h4><h1 id="下载及安装IntelliJ-IDEA-16-1"><a href="#下载及安装IntelliJ-IDEA-16-1" class="headerlink" title="下载及安装IntelliJ IDEA 16.1"></a>下载及安装IntelliJ IDEA 16.1</h1><p>​       1. 登录官网：<a href="https://www.jetbrains.com/idea/" target="_blank" rel="noopener">https://www.jetbrains.com/idea/</a>下载最新版本的编译器。<br>​       2. 安装编译器。</p><h1 id="创建hadoop工程"><a href="#创建hadoop工程" class="headerlink" title="创建hadoop工程"></a>创建hadoop工程</h1><p>​       1. 打开IntelliJ IDEA编译器，创建一个新的工程，点击next<br><img src="http://img.blog.csdn.net/20160615232457648" alt="这里写图片描述"><br>​       2. 输入工程的名字，点击Finish<br><img src="http://img.blog.csdn.net/20160615232731524" alt="这里写图片描述"><br>​       3. 创建如下图的包结构及WordCount.java文件：<br><img src="http://img.blog.csdn.net/20160615233423402" alt="这里写图片描述"><br>​       4. 添加JDK，如果已经配置了JDK可以省略此步骤：在侧边栏右击<img src="http://img.blog.csdn.net/20160615233517597" alt="这里写图片描述">选择“Open Module Settings”<br><img src="http://img.blog.csdn.net/20160615233741840" alt="这里写图片描述"><br>​       点击“news”选择jdk的根目录即可。<br><img src="http://img.blog.csdn.net/20160615234006369" alt="这里写图片描述"><br>​       5. 添加hadoop各种jar包<br>​       打开“Module Settings”点击左侧边栏中的Libraries。<br><img src="http://img.blog.csdn.net/20160615234327296" alt="这里写图片描述"><br>​       点击右侧的“+”号，并选择“Java”，在路径中选择hadoop的各种jar包，我的hadoop jar包路劲为：/usr/hadoop/hadoop-2.6.2/share/hadoop下的所有目录中的jar包。另外还需要特别将/usr/hadoop/hadoop-2.6.2/share/hadoop/common/lib下的所有jar包添加进工程，并点击“Apply”或“OK”。<br><img src="http://img.blog.csdn.net/20160615234555359" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20160615234949085" alt="这里写图片描述"></p><h1 id="配置编译环境"><a href="#配置编译环境" class="headerlink" title="配置编译环境"></a>配置编译环境</h1><p>​       1. 点击右上角的<img src="http://img.blog.csdn.net/20160615235415050" alt="这里写图片描述">中的下拉箭头，点击“Edit Configurations…”，并点击左上角的“+”号，并选择“Application”<br><img src="http://img.blog.csdn.net/20160615235725364" alt="这里写图片描述"><br>​       2. 在“Main class”中填写我们需要运行的程序：com.wk51920.WordCount;<br>​        在“Program arguments”中填写程序需要的“输入文件”和“输出文件”。在此程序中，“输入文件”即需要用WordCount去统计单词的源文件的位置，“输出文件”即保存统计结果的文件。此栏的完整内容为：hdfs://master:8020/input/README.txt hdfs://master:8020/output/。这两个路径根据你配置的hadoop环境相关，即core-site.xml配置文件中的fs.defaultFS属性的值，即是HDFS系统的根目录。<br>​       在“Name”处改为：hadoop,点击“Apply”。<br><img src="http://img.blog.csdn.net/20160616000927594" alt="这里写图片描述"></p><h1 id="填写WordCount代码"><a href="#填写WordCount代码" class="headerlink" title="填写WordCount代码"></a>填写WordCount代码</h1><p>​       选择WordCount文件，写入如下代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">package com.wk51920;</span><br><span class="line"></span><br><span class="line">import org.apache.hadoop.fs.Path;</span><br><span class="line">import org.apache.hadoop.io.IntWritable;</span><br><span class="line">import org.apache.hadoop.io.LongWritable;</span><br><span class="line">import org.apache.hadoop.io.Text;</span><br><span class="line">import org.apache.hadoop.mapred.*;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.Iterator;</span><br><span class="line">import java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by wk51920 on 16/6/3.</span><br><span class="line"> */</span><br><span class="line">public class WordCount  &#123;</span><br><span class="line">    public static class Map extends MapReduceBase implements Mapper&lt;LongWritable, Text, Text, IntWritable&gt;&#123;</span><br><span class="line">        private final static IntWritable one = new IntWritable(1);</span><br><span class="line">        private Text word = new Text();</span><br><span class="line">        @Override</span><br><span class="line">        public void map(LongWritable longWritable, Text text, OutputCollector&lt;Text, IntWritable&gt; outputCollector, Reporter reporter) throws IOException &#123;</span><br><span class="line">            String line = text.toString();</span><br><span class="line">            StringTokenizer tokenizer = new StringTokenizer(line);</span><br><span class="line">            while(tokenizer.hasMoreTokens())&#123;</span><br><span class="line">                word.set(tokenizer.nextToken());</span><br><span class="line">                outputCollector.collect(word,one);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Reduce extends MapReduceBase implements Reducer&lt;Text,IntWritable,Text, IntWritable&gt;&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void reduce(Text text, Iterator&lt;IntWritable&gt; iterator, OutputCollector&lt;Text, IntWritable&gt; outputCollector, Reporter reporter) throws IOException &#123;</span><br><span class="line">            int sum= 0;</span><br><span class="line">            while(iterator.hasNext())&#123;</span><br><span class="line">                sum += iterator.next().get();</span><br><span class="line">            &#125;</span><br><span class="line">            outputCollector.collect(text, new IntWritable(sum));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        JobConf conf = new JobConf(WordCount.class);</span><br><span class="line">        conf.setJobName(&quot;wordCount&quot;);</span><br><span class="line">        conf.setOutputKeyClass(Text.class);</span><br><span class="line">        conf.setOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        conf.setMapperClass(Map.class);</span><br><span class="line">        conf.setReducerClass(Reduce.class);</span><br><span class="line"></span><br><span class="line">        conf.setInputFormat(TextInputFormat.class);</span><br><span class="line">        conf.setOutputFormat(TextOutputFormat.class);</span><br><span class="line"></span><br><span class="line">        FileInputFormat.setInputPaths(conf,new Path(args[0]));</span><br><span class="line">        FileOutputFormat.setOutputPath(conf, new Path(args[1]));</span><br><span class="line"></span><br><span class="line">        JobClient.runJob(conf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061</span><br></pre></td></tr></table></figure><h1 id="将文件放入HDFS系统"><a href="#将文件放入HDFS系统" class="headerlink" title="将文件放入HDFS系统"></a>将文件放入HDFS系统</h1><p>​       如果没有启动hadoop服务，先启动服务。</p><p>​       1. 在hdfs系统中建立input文件夹：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /input  1</span><br></pre></td></tr></table></figure><p>​       2. 将本地的README.txt放入HDFS中的input文件夹下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -copyFromLocal README.txt /input1</span><br></pre></td></tr></table></figure><h3 id="注意运行此程序前，在HDFS系统上不能存在output文件夹，如果存在请删除再运行程序。"><a href="#注意运行此程序前，在HDFS系统上不能存在output文件夹，如果存在请删除再运行程序。" class="headerlink" title="注意运行此程序前，在HDFS系统上不能存在output文件夹，如果存在请删除再运行程序。"></a>注意运行此程序前，在HDFS系统上不能存在output文件夹，如果存在请删除再运行程序。</h3><h1 id="运行WordCount程序"><a href="#运行WordCount程序" class="headerlink" title="运行WordCount程序"></a>运行WordCount程序</h1><p>​        选择WordCount文件，并在代码区右击，选择“Run ‘hadoop’”<br><img src="http://img.blog.csdn.net/20160616002221754" alt="这里写图片描述"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;​       前段时间配置好了基于mac的hadoop完全分布式环境，一直想着怎么样去用编译器写程序然后直接在hadoop环境中运行呢，经
      
    
    </summary>
    
      <category term="Hadoop" scheme="http://yoursite.com/categories/Hadoop/"/>
    
    
      <category term="Hadoop" scheme="http://yoursite.com/tags/Hadoop/"/>
    
      <category term="IDEA" scheme="http://yoursite.com/tags/IDEA/"/>
    
  </entry>
  
  <entry>
    <title>Java反射</title>
    <link href="http://yoursite.com/2018/03/06/Java%E5%8F%8D%E5%B0%84/"/>
    <id>http://yoursite.com/2018/03/06/Java反射/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:54:53.679Z</updated>
    
    <content type="html"><![CDATA[<p>##反射的代码示例</p><ul><li>通过反射的方式可以获取class对象中的属性、方法、构造函数等，一下是实例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.java.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReflect</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> String className = <span class="keyword">null</span>;</span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line"><span class="keyword">public</span> Class personClass = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 反射Person类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">className = <span class="string">"cn.java.reflect.Person"</span>;</span><br><span class="line">personClass = Class.forName(className);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *获取某个class文件对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getClassName</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(personClass);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *获取某个class文件对象的另一种方式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getClassName2</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(Person.class);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *创建一个class文件表示的真实对象，底层会调用空参数的构造方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getNewInstance</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(personClass.newInstance());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *获取非私有的构造函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"rawtypes"</span>, <span class="string">"unchecked"</span> &#125;)</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPublicConstructor</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Constructor  constructor  = personClass.getConstructor(Long.class,String.class);</span><br><span class="line">Person person = (Person)constructor.newInstance(<span class="number">100L</span>,<span class="string">"zhangsan"</span>);</span><br><span class="line">System.out.println(person.getId());</span><br><span class="line">System.out.println(person.getName());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *获得私有的构造函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"rawtypes"</span>, <span class="string">"unchecked"</span> &#125;)</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPrivateConstructor</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Constructor con = personClass.getDeclaredConstructor(String.class);</span><br><span class="line">con.setAccessible(<span class="keyword">true</span>);<span class="comment">//强制取消Java的权限检测</span></span><br><span class="line">Person person2 = (Person)con.newInstance(<span class="string">"zhangsan"</span>);</span><br><span class="line">System.out.println(person2.getName());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *获取非私有的成员变量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"rawtypes"</span>, <span class="string">"unchecked"</span> &#125;)</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getNotPrivateField</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Constructor  constructor  = personClass.getConstructor(Long.class,String.class);</span><br><span class="line">Object obj = constructor.newInstance(<span class="number">100L</span>,<span class="string">"zhangsan"</span>);</span><br><span class="line"></span><br><span class="line">Field field = personClass.getField(<span class="string">"name"</span>);</span><br><span class="line">field.set(obj, <span class="string">"lisi"</span>);</span><br><span class="line">System.out.println(field.get(obj));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *获取私有的成员变量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"rawtypes"</span>, <span class="string">"unchecked"</span> &#125;)</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPrivateField</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Constructor  constructor  = personClass.getConstructor(Long.class);</span><br><span class="line">Object obj = constructor.newInstance(<span class="number">100L</span>);</span><br><span class="line"></span><br><span class="line">Field field2 = personClass.getDeclaredField(<span class="string">"id"</span>);</span><br><span class="line">field2.setAccessible(<span class="keyword">true</span>);<span class="comment">//强制取消Java的权限检测</span></span><br><span class="line">field2.set(obj,<span class="number">10000L</span>);</span><br><span class="line">System.out.println(field2.get(obj));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *获取非私有的成员函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"unchecked"</span> &#125;)</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getNotPrivateMethod</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(personClass.getMethod(<span class="string">"toString"</span>));</span><br><span class="line"></span><br><span class="line">Object obj = personClass.newInstance();<span class="comment">//获取空参的构造函数</span></span><br><span class="line">Object object = personClass.getMethod(<span class="string">"toString"</span>).invoke(obj);</span><br><span class="line">System.out.println(object);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *获取私有的成员函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPrivateMethod</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Object obj = personClass.newInstance();<span class="comment">//获取空参的构造函数</span></span><br><span class="line">Method method = personClass.getDeclaredMethod(<span class="string">"getSomeThing"</span>);</span><br><span class="line">method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">Object value = method.invoke(obj);</span><br><span class="line">System.out.println(value);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">otherMethod</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//当前加载这个class文件的那个类加载器对象</span></span><br><span class="line">System.out.println(personClass.getClassLoader());</span><br><span class="line"><span class="comment">//获取某个类实现的所有接口</span></span><br><span class="line">Class[] interfaces = personClass.getInterfaces();</span><br><span class="line"><span class="keyword">for</span> (Class class1 : interfaces) &#123;</span><br><span class="line">System.out.println(class1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//反射当前这个类的直接父类</span></span><br><span class="line">System.out.println(personClass.getGenericSuperclass());</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * getResourceAsStream这个方法可以获取到一个输入流，这个输入流会关联到name所表示的那个文件上。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//path 不以’/'开头时默认是从此类所在的包下取资源，以’/'开头则是从ClassPath根下获取。其只是通过path构造一个绝对路径，最终还是由ClassLoader获取资源。</span></span><br><span class="line">System.out.println(personClass.getResourceAsStream(<span class="string">"/log4j.properties"</span>));</span><br><span class="line"><span class="comment">//默认则是从ClassPath根下获取，path不能以’/'开头，最终是由ClassLoader获取资源。</span></span><br><span class="line">System.out.println(personClass.getResourceAsStream(<span class="string">"/log4j.properties"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断当前的Class对象表示是否是数组</span></span><br><span class="line">System.out.println(personClass.isArray());</span><br><span class="line">System.out.println(<span class="keyword">new</span> String[<span class="number">3</span>].getClass().isArray());</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断当前的Class对象表示是否是枚举类</span></span><br><span class="line">System.out.println(personClass.isEnum());</span><br><span class="line">System.out.println(Class.forName(<span class="string">"cn.java.reflect.City"</span>).isEnum());</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断当前的Class对象表示是否是接口</span></span><br><span class="line">System.out.println(personClass.isInterface());</span><br><span class="line">System.out.println(Class.forName(<span class="string">"cn.java.reflect.TestInterface"</span>).isInterface());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##反射的代码示例&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过反射的方式可以获取class对象中的属性、方法、构造函数等，一下是实例&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Java-Nio学习</title>
    <link href="http://yoursite.com/2018/03/06/Java-nio/"/>
    <id>http://yoursite.com/2018/03/06/Java-nio/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:54:09.767Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java-nio"><a href="#Java-nio" class="headerlink" title="Java-nio"></a>Java-nio</h1><h2 id="nio原理学习"><a href="#nio原理学习" class="headerlink" title="nio原理学习"></a>nio原理学习</h2><h3 id="nio简介"><a href="#nio简介" class="headerlink" title="nio简介"></a>nio简介</h3><blockquote><p>nio 是New IO 的简称，在jdk1.4 里提供的新api 。Sun 官方标榜的特性如下： 为所有的原始类型提供(Buffer)缓存支持。字符集编码解码解决方案。 Channel ：一个新的原始I/O 抽象。 支持锁和内存映射文件的文件访问接口。 提供多路(non-bloking) 非阻塞式的高伸缩性网络I/O 。</p></blockquote><h3 id="传统的I-O"><a href="#传统的I-O" class="headerlink" title="传统的I/O"></a>传统的I/O</h3><ul><li><p>使用传统的I/O程序读取文件内容, 并写入到另一个文件(或Socket), 如下程序:</p><ul><li><code>File.read(fileDesc, buf, len);</code></li><li><code>Socket.send(socket, buf, len);</code></li></ul></li><li><p>会有较大的性能开销, 主要表现在一下两方面:</p><ol><li><p>上下文切换(context switch), 此处有4次用户态和内核态的切换</p></li><li><p>Buffer内存开销, 一个是应用程序buffer, 另一个是系统读取buffer以及socket buffer其运行示意图如下</p><p>​</p></li></ol></li></ul><p><img src="http://ou9crezlk.bkt.clouddn.com/blog/170930/JcGb1GE8ce.png?imageslim" alt="mark"></p><ol><li>先将文件内容从磁盘中拷贝到操作系统buffer</li></ol><ol><li>再从操作系统buffer拷贝到程序应用buffer</li></ol><ol><li>从程序buffer拷贝到socket buffer</li><li>从socket buffer拷贝到协议引擎.</li></ol><h3 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h3><ul><li><p>NIO技术省去了将操作系统的read buffer拷贝到程序的buffer, 以及从程序buffer拷贝到socket buffer的步骤, 直接将 read buffer 拷贝到 socket buffer. java 的 <code>FileChannel.transferTo()</code> 方法就是这样的实现, 这个实现是依赖于操作系统底层的<code>sendFile()</code>实现的.</p></li><li><p><code>publicvoid transferTo(long position, long count, WritableByteChannel target);</code></p><p>他的底层调用的是系统调用sendFile()方法</p><p><code>sendfile(int out_fd, int in_fd, off_t *offset, size_t count);</code></p><p>如下图</p><p><img src="http://ou9crezlk.bkt.clouddn.com/blog/170930/3cdejCHKjI.png?imageslim" alt="mark"></p></li></ul><h3 id="传统socket和socket-nio代码"><a href="#传统socket和socket-nio代码" class="headerlink" title="传统socket和socket nio代码"></a>传统socket和socket nio代码</h3><ul><li><p>传统socket</p><ul><li><p>server</p></li><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 监听端口</span></span><br><span class="line">ServerSocket server_socket = <span class="keyword">new</span> ServerSocket(<span class="number">2000</span>);</span><br><span class="line">System.out.println(<span class="string">"等待，端口为："</span> + server_socket.getLocalPort());</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">// 阻塞接受消息</span></span><br><span class="line">Socket socket = server_socket.accept();</span><br><span class="line"><span class="comment">// 打印链接信息</span></span><br><span class="line">System.out.println(<span class="string">"新连接： "</span> + socket.getInetAddress() + <span class="string">":"</span></span><br><span class="line">+ socket.getPort());</span><br><span class="line"><span class="comment">// 从socket中获取流</span></span><br><span class="line">DataInputStream input = <span class="keyword">new</span> DataInputStream(socket.getInputStream());</span><br><span class="line"><span class="comment">// 接收数据</span></span><br><span class="line"><span class="keyword">byte</span>[] byteArray = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4096</span>];</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> nread = input.read(byteArray, <span class="number">0</span>, <span class="number">4096</span>);</span><br><span class="line">System.out.println(<span class="keyword">new</span> String(byteArray, <span class="string">"UTF-8"</span>));</span><br><span class="line"><span class="keyword">if</span> (-<span class="number">1</span> == nread) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">socket.close();</span><br><span class="line">System.out.println(<span class="string">"Connection closed by client"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>client</p></li><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"><span class="comment">// 创建socket链接</span></span><br><span class="line">Socket socket = <span class="keyword">new</span> Socket(<span class="string">"localhost"</span>, <span class="number">2000</span>);</span><br><span class="line">System.out.println(<span class="string">"Connected with server "</span> + socket.getInetAddress()</span><br><span class="line">+ <span class="string">":"</span> + socket.getPort());</span><br><span class="line"><span class="comment">// 读取文件</span></span><br><span class="line">FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">"C:/sss.txt"</span>);</span><br><span class="line"><span class="comment">// 输出文件</span></span><br><span class="line">DataOutputStream output = <span class="keyword">new</span> DataOutputStream(socket.getOutputStream());</span><br><span class="line"><span class="comment">// 缓冲区4096K</span></span><br><span class="line"><span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4096</span>];</span><br><span class="line"><span class="comment">// 传输长度</span></span><br><span class="line"><span class="keyword">long</span> read = <span class="number">0</span>, total = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 读取文件，写到socketio中</span></span><br><span class="line"><span class="keyword">while</span> ((read = inputStream.read(b)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">total = total + read;</span><br><span class="line">output.write(b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 关闭</span></span><br><span class="line">output.close();</span><br><span class="line">socket.close();</span><br><span class="line">inputStream.close();</span><br><span class="line"><span class="comment">// 打印时间</span></span><br><span class="line">System.out.println(<span class="string">"bytes send--"</span> + total + <span class="string">" and totaltime--"</span></span><br><span class="line">+ (System.currentTimeMillis() - start));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>socket nio 代码</p><ul><li><p>server</p><ul><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">// 创建socket channel</span></span><br><span class="line">ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">ServerSocket ss = serverSocketChannel.socket();</span><br><span class="line">ss.setReuseAddress(<span class="keyword">true</span>);<span class="comment">// 地址重用</span></span><br><span class="line">ss.bind(<span class="keyword">new</span> InetSocketAddress(<span class="string">"localhost"</span>, <span class="number">9026</span>));<span class="comment">// 绑定地址</span></span><br><span class="line">System.out.println(<span class="string">"监听端口 : "</span></span><br><span class="line">+ <span class="keyword">new</span> InetSocketAddress(<span class="string">"localhost"</span>, <span class="number">9026</span>).toString());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 分配一个新的字节缓冲区</span></span><br><span class="line">ByteBuffer dst = ByteBuffer.allocate(<span class="number">4096</span>);</span><br><span class="line"><span class="comment">// 读取数据</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">SocketChannel channle = serverSocketChannel.accept();<span class="comment">// 接收数据</span></span><br><span class="line">System.out.println(<span class="string">"Accepted : "</span> + channle);</span><br><span class="line">channle.configureBlocking(<span class="keyword">true</span>);<span class="comment">// 设置阻塞，接不到就停</span></span><br><span class="line"><span class="keyword">int</span> nread = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (nread != -<span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">nread = channle.read(dst);<span class="comment">// 往缓冲区里读</span></span><br><span class="line"><span class="keyword">byte</span>[] array = dst.array();<span class="comment">//将数据转换为array</span></span><br><span class="line"><span class="comment">//打印</span></span><br><span class="line">String string = <span class="keyword">new</span> String(array, <span class="number">0</span>, dst.position());</span><br><span class="line">System.out.print(string);</span><br><span class="line">dst.clear();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">nread = -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>client</p><ul><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"><span class="comment">// 打开socket的nio管道</span></span><br><span class="line">SocketChannel sc = SocketChannel.open();</span><br><span class="line">sc.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"localhost"</span>, <span class="number">9026</span>));<span class="comment">// 绑定相应的ip和端口</span></span><br><span class="line">sc.configureBlocking(<span class="keyword">true</span>);<span class="comment">// 设置阻塞</span></span><br><span class="line"><span class="comment">// 将文件放到channel中</span></span><br><span class="line">FileChannel fc = <span class="keyword">new</span> FileInputStream(<span class="string">"C:/sss.txt"</span>).getChannel();<span class="comment">// 打开文件管道</span></span><br><span class="line"><span class="comment">//做好标记量</span></span><br><span class="line"><span class="keyword">long</span> size = fc.size();</span><br><span class="line"><span class="keyword">int</span> pos = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> offset = <span class="number">4096</span>;</span><br><span class="line"><span class="keyword">long</span> curnset = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">long</span> counts = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//循环写</span></span><br><span class="line"><span class="keyword">while</span> (pos&lt;size) &#123;</span><br><span class="line">curnset = fc.transferTo(pos, <span class="number">4096</span>, sc);<span class="comment">// 把文件直接读取到socket chanel中，返回文件大小</span></span><br><span class="line">pos+=offset;</span><br><span class="line">counts+=curnset;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//关闭</span></span><br><span class="line">fc.close();</span><br><span class="line">sc.close();</span><br><span class="line"><span class="comment">//打印传输字节数</span></span><br><span class="line">System.out.println(counts);</span><br><span class="line"><span class="comment">// 打印时间</span></span><br><span class="line">System.out.println(<span class="string">"bytes send--"</span> + counts + <span class="string">" and totaltime--"</span></span><br><span class="line">+ (System.currentTimeMillis() - start));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Java-nio&quot;&gt;&lt;a href=&quot;#Java-nio&quot; class=&quot;headerlink&quot; title=&quot;Java-nio&quot;&gt;&lt;/a&gt;Java-nio&lt;/h1&gt;&lt;h2 id=&quot;nio原理学习&quot;&gt;&lt;a href=&quot;#nio原理学习&quot; class=&quot;header
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="Nio" scheme="http://yoursite.com/tags/Nio/"/>
    
  </entry>
  
  <entry>
    <title>Java动态代理</title>
    <link href="http://yoursite.com/2018/03/06/Java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
    <id>http://yoursite.com/2018/03/06/Java动态代理/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:54:41.214Z</updated>
    
    <content type="html"><![CDATA[<h2 id="业务场景"><a href="#业务场景" class="headerlink" title="业务场景"></a>业务场景</h2><ol><li>旧业务<ul><li>买家调用action，购买衣服，衣服在数据库的标价为50元，购买流程就是简单的调用。</li></ul></li><li>新业务<ul><li>在原先的价格上可以使用优惠券，但是这个功能在以前没有实现过，我们通过代理类，代理了原先的接口方法，在这个方法的基础上，修改了返回值。<img src="http://ou9crezlk.bkt.clouddn.com/blog/170930/b0AHh2bH35.png?imageslim" alt="mark"></li></ul></li></ol><h2 id="代理实现流程"><a href="#代理实现流程" class="headerlink" title="代理实现流程"></a>代理实现流程</h2><ol><li>书写代理类和代理方法，在代理方法中实现代理Proxy.newProxyInstance</li><li>代理中需要的参数分别为：被代理的类的类加载器soneObjectclass.getClassLoader()，被代理类的所有实现接口new Class[] { Interface.class }，句柄方法new InvocationHandler()</li><li>在句柄方法中复写invoke方法，invoke方法的输入有3个参数Object proxy（代理类对象）, Method method（被代理类的方法）,Object[] args（被代理类方法的传入参数），在这个方法中，我们可以定制化的开发新的业务。</li><li>获取代理类，强转成被代理的接口</li><li>最后，我们可以像没被代理一样，调用接口的认可方法，方法被调用后，方法名和参数列表将被传入代理类的invoke方法中，进行新业务的逻辑流程。</li></ol><h3 id="原业务接口IBoss"><a href="#原业务接口IBoss" class="headerlink" title="原业务接口IBoss"></a>原业务接口IBoss</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IBoss</span> </span>&#123;<span class="comment">//接口</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">yifu</span><span class="params">(String size)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="原业务实现类"><a href="#原业务实现类" class="headerlink" title="原业务实现类"></a>原业务实现类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boss</span> <span class="keyword">implements</span> <span class="title">IBoss</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">yifu</span><span class="params">(String size)</span></span>&#123;</span><br><span class="line">System.err.println(<span class="string">"天猫小强旗舰店，老板给客户发快递----衣服型号："</span>+size);</span><br><span class="line"><span class="comment">//这件衣服的价钱，从数据库读取</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">50</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">kuzi</span><span class="params">()</span></span>&#123;</span><br><span class="line">System.err.println(<span class="string">"天猫小强旗舰店，老板给客户发快递----裤子"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="原业务调用"><a href="#原业务调用" class="headerlink" title="原业务调用"></a>原业务调用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaleAction</span> </span>&#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saleByBossSelf</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">IBoss boss = <span class="keyword">new</span> Boss();</span><br><span class="line">System.out.println(<span class="string">"老板自营！"</span>);</span><br><span class="line"><span class="keyword">int</span> money = boss.yifu(<span class="string">"xxl"</span>);</span><br><span class="line">System.out.println(<span class="string">"衣服成交价："</span> + money);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="代理类"><a href="#代理类" class="headerlink" title="代理类"></a>代理类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IBoss <span class="title">getProxyBoss</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> discountCoupon)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Object proxedObj = Proxy.newProxyInstance(Boss.class.getClassLoader(),</span><br><span class="line"><span class="keyword">new</span> Class[] &#123; IBoss.class &#125;, <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method,</span></span></span><br><span class="line"><span class="function"><span class="params">Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">Integer returnValue = (Integer) method.invoke(<span class="keyword">new</span> Boss(),</span><br><span class="line">args);<span class="comment">// 调用原始对象以后返回的值</span></span><br><span class="line"><span class="keyword">return</span> returnValue - discountCoupon;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> (IBoss)proxedObj;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="新业务调用"><a href="#新业务调用" class="headerlink" title="新业务调用"></a>新业务调用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxySaleAction</span> </span>&#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saleByProxy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">IBoss boss = ProxyBoss.getProxyBoss(<span class="number">20</span>);<span class="comment">// 将代理的方法实例化成接口</span></span><br><span class="line">System.out.println(<span class="string">"代理经营！"</span>);</span><br><span class="line"><span class="keyword">int</span> money = boss.yifu(<span class="string">"xxl"</span>);<span class="comment">// 调用接口的方法，实际上调用方式没有变</span></span><br><span class="line">System.out.println(<span class="string">"衣服成交价："</span> + money);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;业务场景&quot;&gt;&lt;a href=&quot;#业务场景&quot; class=&quot;headerlink&quot; title=&quot;业务场景&quot;&gt;&lt;/a&gt;业务场景&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;旧业务&lt;ul&gt;
&lt;li&gt;买家调用action，购买衣服，衣服在数据库的标价为50元，购买流程就是简单的调用。&lt;/
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Let&#39;s Encrypt 使用教程，免费的 SSL 证书</title>
    <link href="http://yoursite.com/2018/03/06/Let&#39;s%20Encrypt%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%8C%E5%85%8D%E8%B4%B9%E7%9A%84%20SSL%20%E8%AF%81%E4%B9%A6/"/>
    <id>http://yoursite.com/2018/03/06/Let&#39;s Encrypt 使用教程，免费的 SSL 证书/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:57:36.585Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Let’s-Encrypt-简介"><a href="#Let’s-Encrypt-简介" class="headerlink" title="Let’s Encrypt 简介"></a>Let’s Encrypt 简介</h2><p>Let’s Encrypt 是国外一个公共的免费SSL项目，由 Linux 基金会托管，它的来头不小，由 Mozilla、思科、Akamai、IdenTrust 和 EFF 等组织发起，目的就是向网站自动签发和管理免费证书，以便加速互联网由 HTTP 过渡到 HTTPS，目前 Facebook 等大公司开始加入赞助行列。</p><p>Let’s Encrypt 已经得了 IdenTrust 的交叉签名，这意味着其证书现在已经可以被 Mozilla、Google、Microsoft 和 Apple 等主流的浏览器所信任，你只需要在 Web 服务器证书链中配置交叉签名，浏览器客户端会自动处理好其它的一切，Let’s Encrypt 安装简单，使用非常方便。</p><h2 id="Certbot-简介"><a href="#Certbot-简介" class="headerlink" title="Certbot 简介"></a>Certbot 简介</h2><p>Certbot 为 Let’s Encrypt 项目发布了一个官方的客户端 Certbot ，利用它可以完全自动化的获取、部署和更新安全证书，并且 Certbot 是支持所有 Unix 内核的操作系统。</p><h2 id="安装-Certbot-客户端"><a href="#安装-Certbot-客户端" class="headerlink" title="安装 Certbot 客户端"></a>安装 Certbot 客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum install certbot # centos</span><br><span class="line">$ # apt install certbot # ubuntu</span><br></pre></td></tr></table></figure><h3 id="Certbot-的两种使用方式"><a href="#Certbot-的两种使用方式" class="headerlink" title="Certbot 的两种使用方式"></a>Certbot 的两种使用方式</h3><p>webroot 方式： certbot 会利用既有的 web server，在其 web root 目录下创建隐藏文件，Let’s Encrypt 服务端会通过域名来访问这些隐藏文件，以确认你的确拥有对应域名的控制权。<br>standalone 方式： Certbot 会自己运行一个 web server 来进行验证。如果我们自己的服务器上已经有 web server 正在运行 （比如 Nginx 或 Apache ），用 standalone 方式的话需要先关掉它，以免冲突。<br>获取证书 webroot 模式<br>使用这种模式会在 web root 中创建 .well-known 文件夹，这个文件夹里面包含了一些验证文件，Certbot 会通过访问 example.com/.well-known/acme-challenge 来验证你的域名是否绑定的这个服务器，所以需要编辑 nginx 配置文件确保可以访问刚刚创建的 .well-known 文件夹及里边存放的验证文件，以便在生成证书时进行验证：</p><p>使用一下命令查看 nginx 配置文件地址：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nginx -t</span><br><span class="line">nginx: the configuration file /usr/local/nginx/nginx.conf syntax is ok  </span><br><span class="line">nginx: configuration file /usr/local/nginx/nginx.conf test is successful</span><br></pre></td></tr></table></figure><p>编辑 /usr/local/nginx/nginx.conf 配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;  </span><br><span class="line">    ...</span><br><span class="line">    location /.well-known/acme-challenge/ &#123;</span><br><span class="line">        default_type &quot;text/plain&quot;;</span><br><span class="line">        root /var/www/example;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重启 nginx 服务</p><p><code>$ nginx -s reload</code>获取证书，–email 为申请者邮箱，–webroot 为 webroot 方式，-w 为站点目录，-d 为要加 https 的域名，以下命令会为 example.com 和 <a href="http://www.example.com" target="_blank" rel="noopener">www.example.com</a> 这两个域名生成一个证书：</p><p><code>$ certbot certonly --email admin@example.com --webroot -w /var/www/example -d example.com -d www.example.com</code>standalone 模式获取证书 但是有些时候我们的一些服务并没有根目录，例如一些微服务，这时候使用 webroot 模式就走不通了。这时可以使用模式 standalone 模式，这种模式不需要指定网站根目录，他会自动启用服务器的443端口，来验证域名的归属。我们有其他服务（例如nginx）占用了443端口，就必须先停止这些服务，在证书生成完毕后，再启用。</p><p><code>$ certbot certonly --email admin@example.com --standalone -d example.com -d www.example.com</code>nginx 开启 https 证书生成完成后可以到 /etc/letsencrypt/live/ 目录下查看对应域名的证书文件。编辑 nginx 配置文件监听 443 端口，启用 SSL，并配置 SSL 的公钥、私钥证书路径：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;  </span><br><span class="line">    listen       443;</span><br><span class="line">    server_name  example.com;</span><br><span class="line">    root         /var/www/example;</span><br><span class="line">    index        index.html index.htm;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;</span><br><span class="line">    charset utf-8;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>添加 HTTP 跳转到 HTTPS：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;  </span><br><span class="line">    listen 80;</span><br><span class="line">    server_name example.com;</span><br><span class="line">    return 301 https://$server_name$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重启 nginx 服务，访问 <a href="https://example.com/" target="_blank" rel="noopener">https://example.com</a> 查看是否配置成功</p><p>自动续期 Let’s Encrypt 提供的证书只有90天的有效期，所以我们要在在证书到期之前重新获取这些证书，Certbot 提供了一个方便的命令 certbot renew，我们可以先使用 –dry-run 测试是否可用：</p><p><code>$ certbot renew --dry-run</code>linux 系统上有 cron 可以来搞定这件事情，使用一下命令新建任务：</p><p><code>$ crontab -e</code>写入一下任务内容。这段内容的意思就是 每隔 两个月的 凌晨 2:15 执行 更新操作</p><p><code>15 2 * */2 * certbot renew --quiet --renew-hook &quot;service nginx restart&quot;</code>参数 表述 –quiet 执行时屏蔽错误以外的所有输出，也可以使用 -q –pre-hook 执行更新操作之前要做的事情 –pre-hook 执行更新操作之前要做的事情 –post-hook 执行更新操作完成后要做的事情 取消证书 可以使用一下命令取消刚刚生成的密匙，也就是以上的反操作：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ certbot revoke --cert-path /etc/letsencrypt/live/example.com/cert.pem</span><br><span class="line">$ certbot delete --cert-name example.com</span><br></pre></td></tr></table></figure><p>至此，整个网站升级到 HTTPS 就完成了。 七牛静态资源也能使用 HTTPS 如果博客里面没有用到外部的一些静态图片等资源，那这时候访问网站，应该会看到地址栏有一把小绿锁了。但是我的博客一直使用的是七牛的免费图床，一直都是 HTTP 外链，所以地址栏的小绿锁也没有显示。</p><p>结束语 如果加上 HTTPS 之后😊锁不够绿的话，检查下站点加载的资源（比如 js、css、照片等）是不是有 HTTP 的，有的话就会导致小锁变为灰色。 在我们使用 HTTP 的时候，打开网页总会遇到第三方偷偷加的一些脚本广告，很是烦人，升级 HTTPS 后他们就无从下手了，欧耶。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Let’s-Encrypt-简介&quot;&gt;&lt;a href=&quot;#Let’s-Encrypt-简介&quot; class=&quot;headerlink&quot; title=&quot;Let’s Encrypt 简介&quot;&gt;&lt;/a&gt;Let’s Encrypt 简介&lt;/h2&gt;&lt;p&gt;Let’s Encrypt 
      
    
    </summary>
    
      <category term="Https" scheme="http://yoursite.com/categories/Https/"/>
    
    
      <category term="Https" scheme="http://yoursite.com/tags/Https/"/>
    
      <category term="Let&#39;s Encrypt" scheme="http://yoursite.com/tags/Let-s-Encrypt/"/>
    
  </entry>
  
  <entry>
    <title>Linux VIM文本编辑器</title>
    <link href="http://yoursite.com/2018/03/06/Linux%20VIM%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8/"/>
    <id>http://yoursite.com/2018/03/06/Linux VIM文本编辑器/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:59:08.133Z</updated>
    
    <content type="html"><![CDATA[<p>##VIM文本编辑器<br><img src="http://ou9crezlk.bkt.clouddn.com/blog/170811/1BLkCHBIj5.png" alt="mark"></p><p>###插入命令<br><img src="http://ou9crezlk.bkt.clouddn.com/blog/170811/8bjIDm0B76.png" alt="mark"></p><p>###定位命令<br><img src="http://ou9crezlk.bkt.clouddn.com/blog/170811/J65aj3C260.png" alt="mark"></p><p>###替换和取消命令<br><img src="http://ou9crezlk.bkt.clouddn.com/blog/170811/aeFBblBdHA.png" alt="mark"></p><p>###删除命令<br><img src="http://ou9crezlk.bkt.clouddn.com/blog/170811/92iAcHk0LJ.png" alt="mark"></p><p>###常用快捷键<br><img src="http://ou9crezlk.bkt.clouddn.com/blog/170811/38L1j4dbmF.png" alt="mark"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##VIM文本编辑器&lt;br&gt;&lt;img src=&quot;http://ou9crezlk.bkt.clouddn.com/blog/170811/1BLkCHBIj5.png&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;###插入命令&lt;br&gt;&lt;img src=&quot;http://ou9cr
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux YUM命令</title>
    <link href="http://yoursite.com/2018/03/06/Linux%20YUM%E5%91%BD%E4%BB%A4/"/>
    <id>http://yoursite.com/2018/03/06/Linux YUM命令/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:59:27.047Z</updated>
    
    <content type="html"><![CDATA[<p>##YUM命令</p><ul><li>Yum（全称为 Yellow dog Updater, Modified）是一个在Fedora和RedHat以及SUSE、CentOS中的Shell前端软件包管理器。基於RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无须繁琐地一次次下载、安装。</li><li>例子（需要上网，没有网络可以建本地源）：<blockquote><p>yum  install  gcc-c++<br>m  remove  gcc-c++<br>m  update  gcc-c++</p></blockquote></li></ul><p>###常用命令</p><ul><li>安装httpd并确认安装<ul><li><code>yum instll -y httpd</code></li></ul></li><li>列出所有可用的package和package组<ul><li><code>yum list</code></li></ul></li><li>清除所有缓冲数据<ul><li><code>yum clean all</code></li></ul></li><li>列出一个包所有依赖的包<ul><li><code>yum deplist httpd</code></li></ul></li><li>删除httpd<ul><li><code>yum remove httpd</code></li></ul></li></ul><p>##制作YUM本地源</p><ul><li><p>YUM源其实就是一个保存了多个RPM包的服务器，可以通过http的方式来检索、下载并安装相关的RPM包</p></li><li><p>制作本地YUM源</p></li></ul><ol><li>准备一台Linux服务器，用最简单的版本CentOS-6.7-x86_64-minimal.iso</li><li>配置好这台服务器的IP地址</li><li>上传CentOS-6.7-x86_64-bin-DVD1.iso到服务器</li><li><p>将CentOS-6.7-x86_64-bin-DVD1.iso镜像挂载到某个目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/iso</span><br><span class="line">mount -o loop CentOS-6.7-x86_64-bin-DVD1.iso /var/iso</span><br></pre></td></tr></table></figure></li><li><p>修改本机上的YUM源配置文件，将源指向自己<br>备份原有的YUM源的配置文件</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br><span class="line">rename .repo .repo.bak *</span><br><span class="line">vi CentOS-Local.repo</span><br></pre></td></tr></table></figure><blockquote><p>[base]<br>name=CentOS-Local<br>baseurl=file:///var/iso<br>gpgcheck=1<br> nabled=1   #很重要，1才启用<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</p></blockquote><p>添加上面内容保存退出</p><ol><li>清除YUM缓冲<br>yum clean all</li><li>列出可用的YUM源<br>yum repolist</li><li>安装相应的软件<br>yum install -y httpd</li><li>开启httpd使用浏览器访问<a href="http://192.168.0.100:80（如果访问不通，检查防火墙是否开启了80端口或关闭防火墙）" target="_blank" rel="noopener">http://192.168.0.100:80（如果访问不通，检查防火墙是否开启了80端口或关闭防火墙）</a><br>service httpd start</li><li>将YUM源配置到httpd（Apache Server）中，其他的服务器即可通过网络访问这个内网中的YUM源了<br>cp -r /var/iso/ /var/www/html/CentOS-6.7</li><li>取消先前挂载的镜像<br>umount /var/iso</li><li>在浏览器中访问<a href="http://192.168.0.100/CentOS-6.7/" target="_blank" rel="noopener">http://192.168.0.100/CentOS-6.7/</a><br><img src="http://ou9crezlk.bkt.clouddn.com/blog/170831/7d1C4lf4l4.png" alt="mark"><br>13.让其他需要安装RPM包的服务器指向这个YUM源，准备一台新的服务器，备份或删除原有的YUM源配置文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br><span class="line">rename .repo .repo.bak *</span><br><span class="line">vi CentOS-Local.repo</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>[base]<br>name=CentOS-Local<br>baseurl=<a href="http://192.168.0.100/CentOS-6.7" target="_blank" rel="noopener">http://192.168.0.100/CentOS-6.7</a><br>gpgcheck=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</p></blockquote><p>添加上面内容保存退出<br>14.在这台新的服务器上执行YUM的命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure></p><p>15.安装相应的软件<br><code>yum install -y gcc</code></p><p>16、加入依赖包到私有yum的repository<br>进入到repo目录<br>执行命令：  <code>createrepo  .</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##YUM命令&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Yum（全称为 Yellow dog Updater, Modified）是一个在Fedora和RedHat以及SUSE、CentOS中的Shell前端软件包管理器。基於RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux cut 提取文本列&amp;&amp;wc 统计命令</title>
    <link href="http://yoursite.com/2018/03/06/Linux%20cut%20%E6%8F%90%E5%8F%96%E6%96%87%E6%9C%AC%E5%88%97&amp;&amp;wc%20%E7%BB%9F%E8%AE%A1%E5%91%BD%E4%BB%A4/"/>
    <id>http://yoursite.com/2018/03/06/Linux cut 提取文本列&amp;&amp;wc 统计命令/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:58:19.518Z</updated>
    
    <content type="html"><![CDATA[<p>##cut命令</p><ul><li>cut命令可以从一个文本文件或者文本流中提取文本列。</li></ul><p>###cut语法</p><ul><li><code>cut -d&#39;分隔字符&#39; -f fields &lt;==用于有特定分隔字符</code></li><li><code>cut -c 字符区间            &lt;==用于排列整齐的信息</code></li><li>选项与参数：<ul><li>-d  ：后面接分隔字符。与 -f 一起使用；</li><li>-f  ：依据 -d 的分隔字符将一段信息分割成为数段，用 -f 取出第几段的意思；</li><li>-c  ：以字符 (characters) 的单位取出固定字符区间；</li></ul></li></ul><p>###举个栗子</p><ul><li><p>PATH 变量如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo $PATH</span><br><span class="line">/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/X11R6/bin:/usr/games</span><br><span class="line"> 1 | 2       | 3   | 4       | 5            | 6            | 7</span><br></pre></td></tr></table></figure></li><li><p>语句：<code>echo $PATH | cut -d &#39;:&#39; -f 5</code></p></li><li><p>结果：将 PATH 变量取出，找出第五个路径。</p><blockquote><p>/usr/local/bin</p></blockquote></li><li><p>语句：<code>echo $PATH | cut -d &#39;:&#39; -f 3,5</code></p></li><li><p>结果：将 PATH 变量取出，我要找出第三和第五个路径。</p><blockquote><p>/sbin:/usr/local/bin</p></blockquote></li><li><p>语句：<code>echo $PATH | cut -d &#39;:&#39; -f 3-</code></p></li><li><p>结果：将 PATH 变量取出，我要找出第三到最后一个路径。</p><blockquote><p>/sbin:/usr/sbin:/usr/local/bin:/usr/X11R6/bin:/usr/games</p></blockquote></li><li><p>语句：<code>echo $PATH | cut -d &#39;:&#39; -f 1-3</code></p></li><li>结果：将 PATH 变量取出，我要找出第一到第三个路径。<blockquote><p>/bin:/usr/bin:/sbin:</p></blockquote></li></ul><ul><li>语句：<code>echo $PATH | cut -d &#39;:&#39; -f 1-3,5</code></li><li>结果：将 PATH 变量取出，我要找出第一到第三，还有第五个路径。<blockquote><p>/bin:/usr/bin:/sbin:/usr/local/bin</p></blockquote></li></ul><p>###实用例子</p><ul><li>语句：<code>cat /etc/passwd | cut -d &#39;:&#39; -f 1,7</code></li><li>结果：只显示/etc/passwd的用户和shell<blockquote><p>root:/bin/bash<br>daemon:/bin/sh<br>bin:/bin/sh</p></blockquote></li></ul><p>##wc命令</p><ul><li>统计文件里面有多少单词，多少行，多少字符。</li></ul><p>###wc语法</p><ul><li><code>wc [-lwm]</code></li><li>选项与参数：<ul><li>-l  ：仅列出行；</li><li>-w  ：仅列出多少字(英文单字)；</li><li>-m  ：多少字符；</li></ul></li></ul><p>###举个栗子</p><ul><li><p>使用wc统计/etc/passwd</p></li><li><p>语句：<code>wc /etc/passwd</code></p></li><li><p>结果：40是行数，45是单词数，1719是字节数</p><blockquote><p>40   45 1719 /etc/passwd</p></blockquote></li><li><p>语句：<code>wc -l /etc/passwd</code></p></li><li><p>结果：统计行数,表示系统有40个账户</p><blockquote><p>40 /etc/passwd</p></blockquote></li><li><p>语句：<code>wc -w /etc/passwd</code></p></li><li><p>结果：统计单词出现次数</p><blockquote><p>45 /etc/passwd</p></blockquote></li><li><p>语句：<code>wc -m /etc/passwd</code></p></li><li>结果：统计文件的字符数<blockquote><p>1719</p></blockquote></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##cut命令&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cut命令可以从一个文本文件或者文本流中提取文本列。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;###cut语法&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cut -d&amp;#39;分隔字符&amp;#39; -f fields &amp;lt;==用于有特定分隔字符&lt;
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux mini安装常见问题</title>
    <link href="http://yoursite.com/2018/03/06/Linux%20mini%E5%AE%89%E8%A3%85%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2018/03/06/Linux mini安装常见问题/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:58:36.403Z</updated>
    
    <content type="html"><![CDATA[<p>##yum安装网络不可达</p><p>###原因</p><ul><li><p>我们来查看一下，当前用来上网的网卡eth1的信息：</p><blockquote><p>[root@promote ~]# ifconfig eth1<br>th1      Link encap:Ethernet  HWaddr 00:0C:29:D4:EA:E2  </p><pre><code>inet addr:192.168.1.115  Bcast:255.255.255.255  Mask:255.255.255.0inet6 addr: fe80::20c:29ff:fed4:eae2/64 Scope:LinkUP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1RX packets:4599 errors:0 dropped:0 overruns:0 frame:0TX packets:2628 errors:0 dropped:0 overruns:0 carrier:0collisions:0 txqueuelen:1000 RX bytes:575396 (561.9 KiB)  TX bytes:278925 (272.3 KiB)Interrupt:19 Base address:0x2000 </code></pre></blockquote></li><li><p>我们清楚地看见了inet6 addr: fe80::20c:29ff:fed4:eae2/64 Scope:Link,这一行信息，这个正是影响我们使用yum的罪魁祸首！！！下面我们就来关闭网卡的IPV6。</p></li></ul><p>###临时解决方法</p><ul><li>临时关闭网卡的IPV6，并重启网络服务：</li></ul><blockquote><p>[root@promote ~]# echo 1 &gt; /proc/sys/net/ipv6/conf/all/disable_ipv6<br> root@promote ~]# echo 1 &gt; /proc/sys/net/ipv6/conf/default/disable_ipv6<br> root@promote ~]# service network restart<br> 在关闭接口 eth1：                                        [确定]<br> 闭环回接口：                                             [确定]<br> 出环回接口：                                             [确定]<br> 出界面 eth1：<br> 在决定 eth1 的 IP 信息…完成。<br>                                                           [确定]</p></blockquote><ul><li>此时，再查看网卡<code>eth1</code>的信息：</li></ul><blockquote><p>[root@promote ~]# ifconfig eth1<br> th1      Link encap:Ethernet  HWaddr 00:0C:29:D4:EA:E2<br>          inet addr:192.168.1.115  Bcast:255.255.255.255  Mask:255.255.255.0<br>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<br>          RX packets:5563 errors:0 dropped:0 overruns:0 frame:0<br>          TX packets:3388 errors:0 dropped:0 overruns:0 carrier:0<br>          collisions:0 txqueuelen:1000<br>          RX bytes:676945 (661.0 KiB)  TX bytes:414358 (404.6 KiB)<br>          Interrupt:19 Base address:0x2000 </p></blockquote><ul><li>没错，我们发现inet6 addr: fe80::20c:29ff:fed4:eae2/64 Scope:Link这一行信息没有了，此时yum就可以正常使用了；</li></ul><p>###永久生效方法</p><ul><li>需要在文件/etc/sysctl.conf中，添加如下的内容：</li></ul><blockquote><p>#shutdown IPv6<br> et.ipv6.conf.all.disable_ipv6 = 1<br> et.ipv6.conf.default.disable_ipv6 = 1</p></blockquote><p>##minimal最小化安装 eth0默认没有自启用</p><ul><li>修改配置文件<ul><li><code>vi /etc/sysconfig/network-scripts/ifcfg-eth0</code><blockquote><p>onboot=true</p></blockquote></li></ul></li></ul><p>##修改静态地址后发现无法ping外网</p><ul><li>需要设置网关（该命令只是临时有效）<ul><li><code>route add default gw 192.168.33.1</code>(网关地址 参考vmware的网关地址)</li></ul></li><li>添加nameserver<ul><li>vi /etc/resolv.conf<blockquote><p>nameserver 192.168.33.1 #vmware的网关地址</p></blockquote></li></ul></li></ul><p>##解决克隆后eth0不见的问题</p><ul><li>直接修改  /etc/sysconfig/network-script/ifcfg-eth0</li><li>删掉UUID  HWADDR</li><li>配置静态地址</li><li>然后：<ul><li><code>rm -rf 　/etc/udev/rules.d/70-persistent-net.rules</code></li></ul></li><li>然后 reboot</li></ul><p>##挂载光驱</p><ul><li>创建需要挂载的目录<ul><li><code>mkdir /mnt/cdrom</code></li></ul></li><li>挂载光驱<ul><li><code>mount -t iso9660 -o ro /dev/cdrom /mnt/cdrom/</code></li></ul></li><li>配置开机自动挂载    <ul><li><code>vim /etc/fstab</code></li><li><code>/dev/cdrom              /mnt/cdrom              iso9660 defaults        0 0</code></li><li><img src="http://ou9crezlk.bkt.clouddn.com/blog/170906/56iEagm84E.png" alt="mark"></li></ul></li></ul><p>##安装scp</p><ul><li><code>yum install -y openssh-clients</code></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##yum安装网络不可达&lt;/p&gt;
&lt;p&gt;###原因&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;我们来查看一下，当前用来上网的网卡eth1的信息：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[root@promote ~]# ifconfig eth1&lt;br&gt;th1      Link 
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux 后台服务管理</title>
    <link href="http://yoursite.com/2018/03/06/Linux%20%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/"/>
    <id>http://yoursite.com/2018/03/06/Linux 后台服务管理/</id>
    <published>2018-03-06T03:50:35.000Z</published>
    <updated>2018-03-06T06:59:37.416Z</updated>
    
    <content type="html"><![CDATA[<p>##后台服务管理</p><ul><li>service network status   查看指定服务的状态</li><li>service network stop     停止指定服务</li><li>service network start    启动指定服务</li><li>service network restart  重启指定服务</li><li>service –status-all  查看系统中所有的后台服务</li></ul><p>###设置后台服务的自启配置</p><ul><li>chkconfig   查看所有服务器自启配置</li><li>chkconfig iptables off   关掉指定服务的自动启动</li><li>chkconfig iptables on   开启指定服务的自动启动</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##后台服务管理&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;service network status   查看指定服务的状态&lt;/li&gt;
&lt;li&gt;service network stop     停止指定服务&lt;/li&gt;
&lt;li&gt;service network start    启动指定服
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
</feed>
